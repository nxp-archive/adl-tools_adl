#
# Checks the behavior of a simplified memory protection unit.  In this test, we
# make sure that the mask expression in a Bounds check works.
#
= asm

	lwz r1,0x1000(r0)   # Hit, way 1
	lwz r2,0x1004(r10)  # Hit, way 1 (due to mask)
	lwz r3,0x1008(r11)  # Hit, way 1 (due to mask)
	stw r2,0x2004(r0)   # Hit, permission failure.
	stw r2,0x2008(r12)  # Hit, permission failure (due to mask).
	.long 0x0	
	# prot fault handler.
	mfspr r29,62
	add   r30,r30,r29
	mfspr r31,SRR0
	addi  r31,r31,4
	mtspr SRR0,r31
	rfi
	.long 0x0
	
= /asm

CORE n=:P

RD n=IVOR7    d=0x18

RD n=GPR i=10 d=0x80000000
RD n=GPR i=11 d=0xf0000000
RD n=GPR i=12 d=0xf0000000

# <GEN>
MD n=Mem ra=0x00000000 d=0x80201000	#	lwz r1,0x1000(r0)   # Hit, way 1
MD n=Mem ra=0x00000004 d=0x804A1004	#	lwz r2,0x1004(r10)  # Hit, way 1 (due to mask)
MD n=Mem ra=0x00000008 d=0x806B1008	#	lwz r3,0x1008(r11)  # Hit, way 1 (due to mask)
MD n=Mem ra=0x0000000c d=0x90402004	#	stw r2,0x2004(r0)   # Hit, permission failure.
MD n=Mem ra=0x00000010 d=0x904C2008	#	stw r2,0x2008(r12)  # Hit, permission failure (due to mask).
MD n=Mem ra=0x00000014 d=0x00000000	#	.long 0x0	
MD n=Mem ra=0x00000018 d=0x7FBE0AA6	#	mfspr r29,62
MD n=Mem ra=0x0000001c d=0x7FDEEA14	#	add   r30,r30,r29
MD n=Mem ra=0x00000020 d=0x7FFA02A6	#	mfspr r31,SRR0
MD n=Mem ra=0x00000024 d=0x3BFF0004	#	addi  r31,r31,4
MD n=Mem ra=0x00000028 d=0x7FFA03A6	#	mtspr SRR0,r31
MD n=Mem ra=0x0000002c d=0x4C000064	#	rfi
MD n=Mem ra=0x00000030 d=0x00000000	#	.long 0x0
# </GEN>

TD n=MpuCam set=0 way=1 LB=0x1000 UM=4 UB=0x1fff SR=1 SW=1 UR=1 UW=1 V=1
TD n=MpuCam set=0 way=2 LB=0x2000 UM=4 UB=0x2fff SR=0 SW=0 UR=0 UW=0 V=1

MD n=Mem ra=0x00001000 d=10
MD n=Mem ra=0x80001004 d=20
MD n=Mem ra=0xf0001008 d=30
MD n=Mem ra=0x00002004 d=0xdeadbeef
MD n=Mem ra=0xf0002008 d=0xdeadbeef

TRACE


RESULTS

MD n=Mem ra=0x00001000 d=10
MD n=Mem ra=0x80001004 d=20
MD n=Mem ra=0xf0001008 d=30
MD n=Mem ra=0x00002004 d=0xdeadbeef
MD n=Mem ra=0xf0002008 d=0xdeadbeef

RD n=GPR i=1  d=10
RD n=GPR i=2  d=20
RD n=GPR i=3  d=30
RD n=GPR i=30 d=0xf000400c
