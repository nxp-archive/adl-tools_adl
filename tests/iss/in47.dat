#
# Basic cache test w/non-word-sized accesses.
#

CORE n=:P

= asm

 lbz  r2,0x1000(0)
 add  r3,r2,r1
 subic. r5,r5,2
 stb  r3,0(r4)
 addi r4,r4,0x2000
 sth  r3,0(r4)
 addi r4,r4,0x2000
 stw  r3,0(r4)
 addi r4,r4,0x2000
 stw  r3,0(r4)

= /asm

= mdopts

 instr-offset: 0x100

= /mdopts

# <GEN>
MD n=Mem ra=0x00000100 d=0x88401000	#	lbz  r2,0x1000(0)
MD n=Mem ra=0x00000104 d=0x7C620A14	#	add  r3,r2,r1
MD n=Mem ra=0x00000108 d=0x34A5FFFE	#	subic. r5,r5,2
MD n=Mem ra=0x0000010c d=0x98640000	#	stb  r3,0(r4)
MD n=Mem ra=0x00000110 d=0x38842000	#	addi r4,r4,0x2000
MD n=Mem ra=0x00000114 d=0xB0640000	#	sth  r3,0(r4)
MD n=Mem ra=0x00000118 d=0x38842000	#	addi r4,r4,0x2000
MD n=Mem ra=0x0000011c d=0x90640000	#	stw  r3,0(r4)
MD n=Mem ra=0x00000120 d=0x38842000	#	addi r4,r4,0x2000
MD n=Mem ra=0x00000124 d=0x90640000	#	stw  r3,0(r4)
# </GEN>

RD n=NIA d=0x0100
RD n=GPR i=1 d=0x1fff
RD n=GPR i=4 d=0x2000
RD n=GPR i=6 d=0xfffffffe

RD n=CCR d=0xc0000000

MD n=Mem ra=0x1000 d=0xdeadbeef
MD n=Mem ra=0x2000 d=0x00000000
MD n=Mem ra=0xfffffffc d=0
MD n=Mem ra=0x00000000 d=0

TRACE

I ea=0x100 id=1
C n=L1i a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L1i a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x100 ra=0x100 d=0x88401000
INSTR op=0x88401000 asm="lbz 2,0,1000"
C n=L1d a=miss t=read set=32 way=0 lm=0x7f ra=0x1000
A l=1 m="L1d miss:  0x1000"
C n=L2 a=miss t=read set=32 way=0 lm=0x7f ra=0x1000
R n=CCR d=0xc0111000
C n=L2 a=load t=read set=32 way=0 lm=0x7f ra=0x1000
C n=L1d a=load t=read set=32 way=0 lm=0x7f ra=0x1000
M n=Mem t=read ea=0x1000 ra=0x1000 d=0xdeadbeef
R n=GPR i=2 d=0x000000de

I ea=0x104 id=2
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x104 ra=0x104 d=0x7c620a14
INSTR op=0x7c620a14 asm="add 3,2,1"
R n=GPR i=3 d=0x000020dd

I ea=0x108 id=3
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x108 ra=0x108 d=0x34a5fffe
INSTR op=0x34a5fffe asm="addic. 5,5,fffe"
R n=GPR i=5 d=0xfffffffe
R n=CR d=0x80000000

I ea=0x10c id=4
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x10c ra=0x10c d=0x98640000
INSTR op=0x98640000 asm="stb 3,4,0"
C n=L1d a=miss t=write set=0 way=0 lm=0x7f ra=0x2000
A l=1 m="L1d miss:  0x2000"
C n=L2 a=miss t=write set=64 way=0 lm=0x7f ra=0x2000
R n=CCR d=0xc0212000
C n=L2 a=load t=write set=64 way=0 lm=0x7f ra=0x2000
C n=L1d a=load t=write set=0 way=0 lm=0x7f ra=0x2000
M n=Mem t=write ea=0x2000 ra=0x2000 d=0xdd000000

I ea=0x110 id=5
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x110 ra=0x110 d=0x38842000
INSTR op=0x38842000 asm="addi 4,4,2000"
R n=GPR i=4 d=0x00004000

I ea=0x114 id=6
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x114 ra=0x114 d=0xb0640000
INSTR op=0xb0640000 asm="sth 3,4,0"
C n=L1d a=miss t=write set=0 way=1 lm=0x7f ra=0x4000
A l=1 m="L1d miss:  0x4000"
C n=L2 a=miss t=write set=0 way=0 lm=0x7f ra=0x4000
R n=CCR d=0xc0313000
C n=L2 a=load t=write set=0 way=0 lm=0x7f ra=0x4000
C n=L1d a=load t=write set=0 way=1 lm=0x7f ra=0x4000
M n=Mem t=write ea=0x4000 ra=0x4000 d=0x20dd0000

I ea=0x118 id=7
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x118 ra=0x118 d=0x38842000
INSTR op=0x38842000 asm="addi 4,4,2000"
R n=GPR i=4 d=0x00006000

I ea=0x11c id=8
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x11c ra=0x11c d=0x90640000
INSTR op=0x90640000 asm="stw 3,4,0"
C n=L1d a=miss t=write set=0 way=2 lm=0x7f ra=0x6000
A l=1 m="L1d miss:  0x6000"
C n=L2 a=miss t=write set=64 way=1 lm=0x7f ra=0x6000
R n=CCR d=0xc0414000
C n=L2 a=load t=write set=64 way=1 lm=0x7f ra=0x6000
C n=L1d a=load t=write set=0 way=2 lm=0x7f ra=0x6000
M n=Mem t=write ea=0x6000 ra=0x6000 d=0x000020dd

I ea=0x120 id=9
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x120 ra=0x120 d=0x38842000
INSTR op=0x38842000 asm="addi 4,4,2000"
R n=GPR i=4 d=0x00008000

I ea=0x124 id=10
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x124 ra=0x124 d=0x90640000
INSTR op=0x90640000 asm="stw 3,4,0"
C n=L1d a=miss t=write set=0 way=3 lm=0x7f ra=0x8000
A l=1 m="L1d miss:  0x8000"
C n=L2 a=miss t=write set=0 way=1 lm=0x7f ra=0x8000
R n=CCR d=0xc0515000
C n=L2 a=load t=write set=0 way=1 lm=0x7f ra=0x8000
C n=L1d a=load t=write set=0 way=3 lm=0x7f ra=0x8000
M n=Mem t=write ea=0x8000 ra=0x8000 d=0x000020dd

I ea=0x128 id=11
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x128 ra=0x128 d=0x0
INSTR op=0x0 asm="halt"

RESULTS

RD n=GPR i=2 d=0xde
RD n=GPR i=3 d=0x20dd
RD n=GPR i=5 d=0xfffffffe

# Basically, nothing should reach memory:  All stored data should still be in the cache.

CD n=L1d set=0 way=0 ra=0x0000000000002000 valid=1 dirty=1 locked=0 d=0xdd000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=1 ra=0x0000000000004000 valid=1 dirty=1 locked=0 d=0x20dd0000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=2 ra=0x0000000000006000 valid=1 dirty=1 locked=0 d=0x000020dd,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=3 ra=0x0000000000008000 valid=1 dirty=1 locked=0 d=0x000020dd,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=32 way=0 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1i set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x88401000,0x7c620a14,0x34a5fffe,0x98640000,0x38842000,0xb0640000,0x38842000,0x90640000,0x38842000,0x90640000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=0 way=0 ra=0x0000000000004000 valid=1 dirty=0 locked=0 d=0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=0 way=1 ra=0x0000000000008000 valid=1 dirty=0 locked=0 d=0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x88401000,0x7c620a14,0x34a5fffe,0x98640000,0x38842000,0xb0640000,0x38842000,0x90640000,0x38842000,0x90640000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=32 way=0 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=64 way=0 ra=0x0000000000002000 valid=1 dirty=0 locked=0 d=0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=64 way=1 ra=0x0000000000006000 valid=1 dirty=0 locked=0 d=0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

MD n=Mem ra=0x0000000000000000 d=0x00000000	# (0)
MD n=Mem ra=0x0000000000002000 d=0x00000000	# (0)
MD n=Mem ra=0x0000000000001000 d=0xdeadbeef	# (3735928559)


