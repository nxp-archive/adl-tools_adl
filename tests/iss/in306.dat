#
# Testing of per-context MMU lookups.
#
# Note:  Assembled using an assembler generated from mod92.adl.
#
= asm

	li r1,1
	trsave 1,0x2000(r0)
	trclear 1
	trload 1,0x2100(r0)
	yield
	trsave 1,0x2100(r0)
	trload 1,0x2000(r0)
	yield
	halt	

T1:
	addi r1,r1,1
	addi r2,r2,2
	lwz	 r3,0x1000(r0)
	addi r3,r3,4
	stw  r3,0x1004(r0)
	yield
	halt

T2:
	addi	r1,r1,10
	lwz 	r3,0x1010(r0)
	addi	r3,r3,20
	stw 	r3,0x1014(r0)
	yield
	halt

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x38200001	#	li r1,1
MD n=Mem ra=0x00000004 d=0xCC202000	#	trsave 1,0x2000(r0)
MD n=Mem ra=0x00000008 d=0xD0200000	#	trclear 1
MD n=Mem ra=0x0000000c d=0xC8202100	#	trload 1,0x2100(r0)
MD n=Mem ra=0x00000010 d=0x7C0000A8	#	yield
MD n=Mem ra=0x00000014 d=0xCC202100	#	trsave 1,0x2100(r0)
MD n=Mem ra=0x00000018 d=0xC8202000	#	trload 1,0x2000(r0)
MD n=Mem ra=0x0000001c d=0x7C0000A8	#	yield
MD n=Mem ra=0x00000020 d=0x00000000	#	halt	
MD n=Mem ra=0x00000024 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000028 d=0x38420002	#	addi r2,r2,2
MD n=Mem ra=0x0000002c d=0x80601000	#	lwz	 r3,0x1000(r0)
MD n=Mem ra=0x00000030 d=0x38630004	#	addi r3,r3,4
MD n=Mem ra=0x00000034 d=0x90601004	#	stw  r3,0x1004(r0)
MD n=Mem ra=0x00000038 d=0x7C0000A8	#	yield
MD n=Mem ra=0x0000003c d=0x00000000	#	halt
MD n=Mem ra=0x00000040 d=0x3821000A	#	addi	r1,r1,10
MD n=Mem ra=0x00000044 d=0x80601010	#	lwz 	r3,0x1010(r0)
MD n=Mem ra=0x00000048 d=0x38630014	#	addi	r3,r3,20
MD n=Mem ra=0x0000004c d=0x90601014	#	stw 	r3,0x1014(r0)
MD n=Mem ra=0x00000050 d=0x7C0000A8	#	yield
MD n=Mem ra=0x00000054 d=0x00000000	#	halt
# </GEN>

CORE n=:P

TD n=TlbCam0 set=0 way=0 EPN=0 RPN=0 SIZE=1 SX=1 V=1

CTX n=Thread cn=0

RD n=NIA d=0x0
RD n=TEN d=0x1

CTX n=Thread cn=1

RD n=NIA d=0x24
RD n=TEN d=0x1

# Maps 0x1000 -> 0xB000
TD n=TlbCam1 set=0 way=0 EPN=0x4 RPN=0x28 SIZE=1 SR=1 SW=1 V=1

# Context we're going to load in.
MD n=Mem ra=0x2100 d=0x00000040 # nia
MD n=Mem ra=0x2104 d=0x00000001 # ten
MD n=Mem ra=0x2108 d=0x00000000 # lr
MD n=Mem ra=0x210c d=0x00000000 # cr
MD n=Mem ra=0x2110 d=0x00000000 # ctr
MD n=Mem ra=0x2114 d=0x00000000 # xer
MD n=Mem ra=0x2118 d=0x00000000 # msr
MD n=Mem ra=0x211c d=0x00000000 # srr0
MD n=Mem ra=0x2120 d=0x00000000 # srr1
MD n=Mem ra=0x2124 d=0x00000000 # gpr0
MD n=Mem ra=0x2128 d=0x0000000a # gpr1
MD n=Mem ra=0x212c d=0x0000000b # gpr2
MD n=Mem ra=0x2130 d=0x00000000
MD n=Mem ra=0x2134 d=0x00000000
MD n=Mem ra=0x2138 d=0x00000000
MD n=Mem ra=0x213c d=0x00000000
MD n=Mem ra=0x2140 d=0x00000000
MD n=Mem ra=0x2144 d=0x00000000
MD n=Mem ra=0x2148 d=0x00000000
MD n=Mem ra=0x214c d=0x00000000
MD n=Mem ra=0x2150 d=0x00000000
MD n=Mem ra=0x2154 d=0x00000000
MD n=Mem ra=0x2158 d=0x00000000
MD n=Mem ra=0x215c d=0x00000000
MD n=Mem ra=0x2160 d=0x00000000
MD n=Mem ra=0x2164 d=0x00000000
MD n=Mem ra=0x2168 d=0x00000000
MD n=Mem ra=0x216c d=0x00000000
MD n=Mem ra=0x2170 d=0x00000000
MD n=Mem ra=0x2174 d=0x00000000
MD n=Mem ra=0x2178 d=0x00000000
MD n=Mem ra=0x217c d=0x00000000
MD n=Mem ra=0x2180 d=0x00000000
MD n=Mem ra=0x2184 d=0x00000000
MD n=Mem ra=0x2188 d=0x00000000
MD n=Mem ra=0x218c d=0x00000000
MD n=Mem ra=0x2190 d=0x00000000
MD n=Mem ra=0x2194 d=0x00000000
MD n=Mem ra=0x2198 d=0x00000000
MD n=Mem ra=0x219c d=0x00000000
MD n=Mem ra=0x21a0 d=0x00000000
MD n=Mem ra=0x21a4 d=0x00000401 # tlbcam1 way 0
MD n=Mem ra=0x21a8 d=0x00002C01 # tlbcam1 way 0
MD n=Mem ra=0x21ac d=0xff000000 # tlbcam1 way 0
MD n=Mem ra=0x21b0 d=0x00000000 # tlbcam1 way 1
MD n=Mem ra=0x21b4 d=0x00000000 # tlbcam1 way 1
MD n=Mem ra=0x21b8 d=0x00000000 # tlbcam1 way 1

MD n=Mem ra=0xa000 d=100
MD n=Mem ra=0xa004 d=0
MD n=Mem ra=0xb010 d=200
MD n=Mem ra=0xb014 d=0

RESULTS

CTX n=Thread cn=1

RD n=GPR i=1 d=1
RD n=GPR i=2 d=2

MD n=Mem ra=0x2128 d=0x00000014 # gpr1
MD n=Mem ra=0x212c d=0x0000000b # gpr2
MD n=Mem ra=0x2130 d=0x000000dc

MD n=Mem ra=0xa000 d=100
MD n=Mem ra=0xa004 d=104
MD n=Mem ra=0xb010 d=200
MD n=Mem ra=0xb014 d=220
