#
# Tests a misaligned 64-bit write, where the first
# word is in cache-enabled space and the second is not.
# We should report valid memory data.
#

= asm

  oris r1,r1,0xdead
  ori  r1,r1,0xbeef
  oris r2,r2,0x1234
  ori  r2,r2,0x5678
  std  r1,0(r10)

= /asm

= aopts

 -mregnames -mppc64

= /aopts

= mdopts

instr-offset: 0x10000

= /mdopts

#
# <GEN>
MD n=Mem ra=0x00010000 d=0x6421DEAD	#	oris r1,r1,0xdead
MD n=Mem ra=0x00010004 d=0x6021BEEF	#	ori  r1,r1,0xbeef
MD n=Mem ra=0x00010008 d=0x64421234	#	oris r2,r2,0x1234
MD n=Mem ra=0x0001000c d=0x60425678	#	ori  r2,r2,0x5678
MD n=Mem ra=0x00010010 d=0xF82A0000	#	std  r1,0(r10)
# </GEN>

CORE n=:P

RD n=GPR i=10 d=0x1ffc

RD n=HDBCR0 d=0x80000000
RD n=CCR    d=0xc0000000

MD n=Mem ra=0xa1ffc d=0
MD n=Mem ra=0xb2000 d=0

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x0 E=0 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x0 E=0 SX=1 SR=1 SW=1 EPN=0x4

# ea=0x2000 ra=0xB2000
TD n=TlbCam set=0 way=2 V=1 TID=0 SIZE=1 TS=0 RPN=0x2c8 WIMG=0x4 E=0 SX=1 SR=1 SW=1 EPN=0x8

# ea=0x3000 ra=0xB7000
TD n=TlbCam set=0 way=3 V=1 TID=0 SIZE=1 TS=0 RPN=0x2dc WIMG=0x0 E=0 SX=1 SR=1 SW=1 EPN=0xc

RD n=NIA d=0x00000000

TRACE

I ea=0x0 id=1
R n=LittleEndian d=0x00000000
R n=CacheInhibited d=0x00000000
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
C n=L1i a=miss t=ifetch set=0 way=0 lm=0x7f ra=0x10000
C n=L2 a=miss t=ifetch set=0 way=0 lm=0x7f ra=0x10000
C n=L2 a=load t=ifetch set=0 way=0 lm=0x7f ra=0x10000
C n=L1i a=load t=ifetch set=0 way=0 lm=0x7f ra=0x10000
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x6421dead
INSTR op=0x6421dead					asm="oris r1,r1,0xdead"
R n=GPR i=1 d=0xdead0000

I ea=0x4 id=2
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
C n=L1i a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x10000
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x6021beef
INSTR op=0x6021beef					asm="ori r1,r1,0xbeef"
R n=GPR i=1 d=0xdeadbeef

I ea=0x8 id=3
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
C n=L1i a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x10000
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x64421234
INSTR op=0x64421234					asm="oris r2,r2,0x1234"
R n=GPR i=2 d=0x12340000

I ea=0xc id=4
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
C n=L1i a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x10000
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x60425678
INSTR op=0x60425678					asm="ori r2,r2,0x5678"
R n=GPR i=2 d=0x12345678

I ea=0x10 id=5
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
C n=L1i a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x10000
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0xf82a0000
INSTR op=0xf82a0000					asm="std r1,r10,0"
D n=Mem t=write ea=0x1ffc nb=8
R n=LittleEndian d=0x00000000
R n=CacheInhibited d=0x00000000
T n=TlbCam t=store  E=0x0 EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
R n=LittleEndian d=0x00000000
R n=CacheInhibited d=0x20000000
T n=TlbCam t=store  E=0x0 EPN=0x8 RPN=0x2c8 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x4
C n=L1d a=miss t=write set=63 way=0 lm=0x7f ra=0xa1f80
C n=L2 a=miss t=write lm=0x7f ra=0xa1f80
C n=L1d a=load t=write set=63 way=0 lm=0x7f ra=0xa1f80
M n=Mem t=write ea=0x1ffc ra=0xa1ffc d=0xdeadbeef
M n=Mem t=write ea=0x2000 ra=0xb2000 d=0x12345678

I ea=0x14 id=6
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
C n=L1i a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x10000
M n=Mem t=ifetch ea=0x14 ra=0x10014 d=0x00000000
INSTR op=0x00000000					asm="halt "

RESULTS

# Only the second store should be in memory, because the first store 
# is still in the cache.

MD n=Mem ra=0xa1ffc d=0x00000000
MD n=Mem ra=0xb2000 d=0x12345678
