#
# Checks the functionality of mod15's TlbIrat, a disconnected tlb used only by
# tlb-writes for modifying the real page.
#
= asm

	lwz r1,0x1000(r0)   # Initial translation w/o irat setup.
	tlbwe	              # The rpn should be modified due to irat.
	lwz r2,0x1000(r0)   # This should take irat into account.
	
= /asm
= aopts
  -mregnames -me500
= /aopts


CORE n=:P

# <GEN>
MD n=Mem ra=0x00000000 d=0x80201000	#	lwz r1,0x1000(r0)   # Initial translation w/o irat setup.
MD n=Mem ra=0x00000004 d=0x7C0007A4	#	tlbwe	              # The rpn should be modified due to irat.
MD n=Mem ra=0x00000008 d=0x80401000	#	lwz r2,0x1000(r0)   # This should take irat into account.
# </GEN>

# rpn1=a1000 rpn2=0xb1000
TD n=TlbIrat set=0 way=0 RPN1=0x284 RPN2=0x2c4

# ea=0x1000 ra=0xA1000
TD n=Tlb4k set=1 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 SX=1 SR=1 SW=1 EPN=0x4

# The same translation as we already have in Tlb4k 1,0.
RD n=MAS0 d=0x00000402
RD n=MAS1 d=0x00028400
RD n=MAS2 d=0xf8000010

MD n=Mem ra=0xa1000 d=0xdeadbeef
MD n=Mem ra=0xb1000 d=0x12345678

TRACE


I ea=0x0 id=1
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x80201000
INSTR op=0x80201000                                     asm="lwz 1,0,0x1000"
D n=Mem t=read ea=0x1000 nb=4
T n=Tlb4k t=load set=1 way=0 ea=0x1000 ra=0xa1000  NV=0x0 EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem t=read ea=0x1000 ra=0xa1000 d=0xdeadbeef
R n=GPR i=1 d=0xdeadbeef

I ea=0x4 id=2
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x7c0007a4
INSTR op=0x7c0007a4                                     asm="tlbwe "
T n=Tlb4k t=write set=1 way=0  NV=0x0 EPN=0x4 RPN=0x2c4 SIZE=0x0 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x1 UX=0x1 V=0x1 WIMG=0x0
A l=1 m="Wrote to lookup with 256 sets and 2 ways."

I ea=0x8 id=3
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x80401000
INSTR op=0x80401000                                     asm="lwz 2,0,0x1000"
D n=Mem t=read ea=0x1000 nb=4
T n=Tlb4k t=load set=1 way=0 ea=0x1000 ra=0xb1000  NV=0x0 EPN=0x4 RPN=0x2c4 SIZE=0x0 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x1 UX=0x1 V=0x1 WIMG=0x0
M n=Mem t=read ea=0x1000 ra=0xb1000 d=0x12345678
R n=GPR i=2 d=0x12345678

I ea=0xc id=4
M n=Mem t=ifetch ea=0xc ra=0xc d=0x00000000
INSTR op=0x00                                   asm="halt "

RESULTS

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=2 d=0x12345678
