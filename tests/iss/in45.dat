#
# Basic cache test to verify that victim and writethrough behavior
# works.
#

CORE n=:P

= asm

	lwz r2,0x1000(r0)
	lwz r3,0x3000(r0)
	stw r2,0(r20)
	addi r20,r20,0x2000
	stw r3,0(r20)
	addi r20,r20,0x2000
	stw r3,0(r20)
	addi r20,r20,0x2000
	stw r3,0(r20)
	addi r20,r20,0x2000
	stw r3,0(r20)
	mtspr 52,r10
	stw r3,0x3004(0)

= /asm

= mdopts

 instr-offset: 0x100

= /mdopts

# <GEN>
MD n=Mem ra=0x00000100 d=0x80401000	# lwz r2,0x1000(r0)
MD n=Mem ra=0x00000104 d=0x80603000	# lwz r3,0x3000(r0)
MD n=Mem ra=0x00000108 d=0x90540000	# stw r2,0(r20)
MD n=Mem ra=0x0000010c d=0x3A942000	# addi r20,r20,0x2000
MD n=Mem ra=0x00000110 d=0x90740000	# stw r3,0(r20)
MD n=Mem ra=0x00000114 d=0x3A942000	# addi r20,r20,0x2000
MD n=Mem ra=0x00000118 d=0x90740000	# stw r3,0(r20)
MD n=Mem ra=0x0000011c d=0x3A942000	# addi r20,r20,0x2000
MD n=Mem ra=0x00000120 d=0x90740000	# stw r3,0(r20)
MD n=Mem ra=0x00000124 d=0x3A942000	# addi r20,r20,0x2000
MD n=Mem ra=0x00000128 d=0x90740000	# stw r3,0(r20)
MD n=Mem ra=0x0000012c d=0x7D540BA6	# mtspr 52,r10
MD n=Mem ra=0x00000130 d=0x90603004	# stw r3,0x3004(0)
# </GEN>

RD n=NIA d=0x0100

RD n=CCR d=0xc0000000

RD n=GPR i=10 d=0xe0000000
RD n=GPR i=20 d=0x2000

MD n=Mem ra=0x1000 d=0xdeadbeef
MD n=Mem ra=0x2000 d=0x00000000
MD n=Mem ra=0x4000 d=0x00000000
MD n=Mem ra=0x6000 d=0x00000000
MD n=Mem ra=0x8000 d=0x00000000
MD n=Mem ra=0xa000 d=0x00000000
MD n=Mem ra=0x3000 d=0x12345678
MD n=Mem ra=0x3004 d=0x00000000

TRACE

I id=1 ea=0x100
C n=L1i a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L1i a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x100 ra=0x100 d=0x80401000
INSTR op=0x80401000 asm="#1 lwz 2,0,4096"
A l=0 m="Pre-read to 0x1000"
C n=L1d a=miss t=read set=32 way=0 lm=0x7f ra=0x1000
C n=L2 a=miss t=read lm=0x7f ra=0x1000
C n=L1d a=load t=read set=32 way=0 lm=0x7f ra=0x1000
M n=Mem ea=0x1000 ra=0x1000 t=read d=0xdeadbeef
R n=GPR i=2 d=0xdeadbeef

I id=2 ea=0x104
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x104 ra=0x104 d=0x80603000
INSTR op=0x80603000 asm="#2 lwz 3,0,12288"
A l=0 m="Pre-read to 0x3000"
C n=L1d a=miss t=read set=32 way=1 lm=0x7f ra=0x3000
C n=L2 a=miss t=read lm=0x7f ra=0x3000
C n=L1d a=load t=read set=32 way=1 lm=0x7f ra=0x3000
M n=Mem ea=0x3000 ra=0x3000 t=read d=0x12345678
R n=GPR i=3 d=0x12345678

I id=3 ea=0x108
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x108 ra=0x108 d=0x90540000
INSTR op=0x90540000 asm="#3 stw 2,20,0"
A l=0 m="Pre-write to 0x2000"
C n=L1d a=miss t=write set=0 way=0 lm=0x7f ra=0x2000
C n=L2 a=miss t=write lm=0x7f ra=0x2000
C n=L1d a=load t=write set=0 way=0 lm=0x7f ra=0x2000
M n=Mem ea=0x2000 ra=0x2000 t=write d=0xdeadbeef

I id=4 ea=0x10c
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x10c ra=0x10c d=0x3a942000
INSTR op=0x3a942000 asm="#4 addi 20,20,8192"
R n=GPR i=20 d=0x00004000

I id=5 ea=0x110
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x110 ra=0x110 d=0x90740000
INSTR op=0x90740000 asm="#5 stw 3,20,0"
A l=0 m="Pre-write to 0x4000"
C n=L1d a=miss t=write set=0 way=1 lm=0x7f ra=0x4000
C n=L2 a=miss t=write lm=0x7f ra=0x4000
C n=L1d a=load t=write set=0 way=1 lm=0x7f ra=0x4000
M n=Mem ea=0x4000 ra=0x4000 t=write d=0x12345678

I id=6 ea=0x114
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x114 ra=0x114 d=0x3a942000
INSTR op=0x3a942000 asm="#6 addi 20,20,8192"
R n=GPR i=20 d=0x00006000

I id=7 ea=0x118
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x118 ra=0x118 d=0x90740000
INSTR op=0x90740000 asm="#7 stw 3,20,0"
A l=0 m="Pre-write to 0x6000"
C n=L1d a=miss t=write set=0 way=2 lm=0x7f ra=0x6000
C n=L2 a=miss t=write lm=0x7f ra=0x6000
C n=L1d a=load t=write set=0 way=2 lm=0x7f ra=0x6000
M n=Mem ea=0x6000 ra=0x6000 t=write d=0x12345678

I id=8 ea=0x11c
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x11c ra=0x11c d=0x3a942000
INSTR op=0x3a942000 asm="#8 addi 20,20,8192"
R n=GPR i=20 d=0x00008000

I id=9 ea=0x120
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x120 ra=0x120 d=0x90740000
INSTR op=0x90740000 asm="#9 stw 3,20,0"
A l=0 m="Pre-write to 0x8000"
C n=L1d a=miss t=write set=0 way=3 lm=0x7f ra=0x8000
C n=L2 a=miss t=write lm=0x7f ra=0x8000
C n=L1d a=load t=write set=0 way=3 lm=0x7f ra=0x8000
M n=Mem ea=0x8000 ra=0x8000 t=write d=0x12345678

I id=10 ea=0x124
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x124 ra=0x124 d=0x3a942000
INSTR op=0x3a942000 asm="#10 addi 20,20,8192"
R n=GPR i=20 d=0x0000a000

I id=11 ea=0x128
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x128 ra=0x128 d=0x90740000
INSTR op=0x90740000 asm="#11 stw 3,20,0"
A l=0 m="Pre-write to 0xa000"
C n=L1d a=miss t=write set=0 way=0 lm=0x7f ra=0xa000
C n=L1d a=evict t=write set=0 way=0 lm=0x7f ra=0x2000
C n=L2 a=miss t=write set=64 way=0 lm=0x7f ra=0x2000
C n=L2 a=miss t=write lm=0x7f ra=0xa000
C n=L1d a=load t=write set=0 way=0 lm=0x7f ra=0xa000
M n=Mem ea=0xa000 ra=0xa000 t=write d=0x12345678

I id=12 ea=0x12c
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x12c ra=0x12c d=0x7d540ba6
INSTR op=0x7d540ba6 asm="#12 mtspr 10,52"
R n=CCR d=0xe0000000

I id=13 ea=0x130
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x130 ra=0x130 d=0x90603004
INSTR op=0x90603004 asm="#13 stw 3,0,12292"
A l=0 m="Pre-write to 0x3004"
C n=L1d a=hit t=write set=32 way=1 lm=0x7f ra=0x3000
C n=L2 a=miss t=write set=96 way=0 lm=0x7f ra=0x3000
C n=L2 a=load t=write set=96 way=0 lm=0x7f ra=0x3000
M n=Mem ea=0x3004 ra=0x3004 t=write d=0x12345678

I id=14 ea=0x134
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x134 ra=0x134 d=0x0
INSTR op=0x0 asm="#14 halt"

RESULTS

CD n=L1d set=0 way=0 ra=0x000000000000a000 valid=1 dirty=1 locked=0 d=0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=1 ra=0x0000000000004000 valid=1 dirty=1 locked=0 d=0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=2 ra=0x0000000000006000 valid=1 dirty=1 locked=0 d=0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=3 ra=0x0000000000008000 valid=1 dirty=1 locked=0 d=0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=32 way=0 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=32 way=1 ra=0x0000000000003000 valid=1 dirty=0 locked=0 d=0x12345678,0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1i set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x80401000,0x80603000,0x90540000,0x3a942000,0x90740000,0x3a942000,0x90740000,0x3a942000,0x90740000,0x3a942000,0x90740000,0x7d540ba6,0x90603004,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x80401000,0x80603000,0x90540000,0x3a942000,0x90740000,0x3a942000,0x90740000,0x3a942000,0x90740000,0x3a942000,0x90740000,0x7d540ba6,0x90603004,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=64 way=0 ra=0x0000000000002000 valid=1 dirty=1 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=96 way=0 ra=0x0000000000003000 valid=1 dirty=0 locked=0 d=0x12345678,0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

MD n=Mem ra=0x0000000000001000 d=0xdeadbeef	# (3735928559)
MD n=Mem ra=0x0000000000002000 d=0x00000000	# (0)
MD n=Mem ra=0x0000000000004000 d=0x00000000	# (0)
MD n=Mem ra=0x0000000000006000 d=0x00000000	# (0)
MD n=Mem ra=0x0000000000008000 d=0x00000000	# (0)
MD n=Mem ra=0x000000000000a000 d=0x00000000	# (0)
MD n=Mem ra=0x0000000000003000 d=0x12345678	# (305419896)
MD n=Mem ra=0x0000000000003004 d=0x12345678	# (305419896)
