#
# Testing of watchpoints, to make sure that we detect watchpoints set for bytes
# internal to words.
#
= asm

	# Check writes to all bytes in a word.
	stb	r1,0x1000(r0)
	stb	r1,0x1001(r0)
	stb	r1,0x1002(r0)
	stb	r1,0x1003(r0)

	# Check to make sure that a misaligned write triggers a watchpoint for its
	# second access.
	stw r1,0x1002(r0)

	# Same for loads...
	lbz	r2,0x1000(r0)
	lbz	r2,0x1001(r0)
	lbz	r2,0x1002(r0)
	lbz	r2,0x1003(r0)

	lwz r2,0x1002(r0)

= /asm

= aopts
 -mregnames -mppc64
= /aopts


# <GEN>
MD n=Mem ra=0x00000000 d=0x98201000	#	stb	r1,0x1000(r0)
MD n=Mem ra=0x00000004 d=0x98201001	#	stb	r1,0x1001(r0)
MD n=Mem ra=0x00000008 d=0x98201002	#	stb	r1,0x1002(r0)
MD n=Mem ra=0x0000000c d=0x98201003	#	stb	r1,0x1003(r0)
MD n=Mem ra=0x00000010 d=0x90201002	#	stw r1,0x1002(r0)
MD n=Mem ra=0x00000014 d=0x88401000	#	lbz	r2,0x1000(r0)
MD n=Mem ra=0x00000018 d=0x88401001	#	lbz	r2,0x1001(r0)
MD n=Mem ra=0x0000001c d=0x88401002	#	lbz	r2,0x1002(r0)
MD n=Mem ra=0x00000020 d=0x88401003	#	lbz	r2,0x1003(r0)
MD n=Mem ra=0x00000024 d=0x80401002	#	lwz r2,0x1002(r0)
# </GEN>

CORE n=:P

RD n=GPR i=1 d=0xdeadbeef

WP t=write ea=0x1000
WP t=write ea=0x1001
WP t=write ea=0x1002
WP t=write ea=0x1003
WP t=write ea=0x1004

WP t=read ea=0x1000
WP t=read ea=0x1001
WP t=read ea=0x1002
WP t=read ea=0x1003
WP t=read ea=0x1004

MD n=Mem ra=0x1000 d=0
MD n=Mem ra=0x1004 d=0

TRACE

I ea=0x0 id=1 tic=1
INSTR op=0x98201000					asm="stb r1,4096(r0)"
D n=Mem t=write ea=0x1000 nb=1
WP ea=0x1000 t=write nb=1 d=0xef

I ea=0x4 id=2 tic=2
INSTR op=0x98201001					asm="stb r1,4097(r0)"
D n=Mem t=write ea=0x1001 nb=1
WP ea=0x1001 t=write nb=1 d=0xef

I ea=0x8 id=3 tic=3
INSTR op=0x98201002					asm="stb r1,4098(r0)"
D n=Mem t=write ea=0x1002 nb=1
WP ea=0x1002 t=write nb=1 d=0xef

I ea=0xc id=4 tic=4
INSTR op=0x98201003					asm="stb r1,4099(r0)"
D n=Mem t=write ea=0x1003 nb=1
WP ea=0x1003 t=write nb=1 d=0xef

I ea=0x10 id=5 tic=5
INSTR op=0x90201002					asm="stw r1,4098(r0)"
D n=Mem t=write ea=0x1002 nb=4
WP ea=0x1002 t=write nb=4 d=0xdeadbeef
WP ea=0x1004 t=write nb=4 d=0xdeadbeef

I ea=0x14 id=6 tic=6
INSTR op=0x88401000					asm="lbz r2,4096(r0)"
D n=Mem t=read ea=0x1000 nb=1
WP ea=0x1000 t=read nb=1
R n=GPR i=2 d=0x000000ef

I ea=0x18 id=7 tic=7
INSTR op=0x88401001					asm="lbz r2,4097(r0)"
D n=Mem t=read ea=0x1001 nb=1
WP ea=0x1001 t=read nb=1
R n=GPR i=2 d=0x000000ef

I ea=0x1c id=8 tic=8
INSTR op=0x88401002					asm="lbz r2,4098(r0)"
D n=Mem t=read ea=0x1002 nb=1
WP ea=0x1002 t=read nb=1
R n=GPR i=2 d=0x000000de

I ea=0x20 id=9 tic=9
INSTR op=0x88401003					asm="lbz r2,4099(r0)"
D n=Mem t=read ea=0x1003 nb=1
WP ea=0x1003 t=read nb=1
R n=GPR i=2 d=0x000000ad

I ea=0x24 id=10 tic=10
INSTR op=0x80401002					asm="lwz r2,4098(r0)"
D n=Mem t=read ea=0x1002 nb=4
WP ea=0x1002 t=read nb=4
WP ea=0x1004 t=read nb=4
R n=GPR i=2 d=0xdeadbeef

I ea=0x28 id=11 tic=11
INSTR op=0x00000000					asm="halt "


RESULTS

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=2 d=0xdeadbeef

MD n=Mem ra=0x1000 d=0xefefdead
MD n=Mem ra=0x1004 d=0xbeef0000
