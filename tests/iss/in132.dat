#
# This is designed to test a uADL situation, where, due to aliasing,
# extra instruction fetches can be left behind and confuse subsequent
# instructions fetched from the same EA but different RA.
#
= asm

 lwz  r1,0x1000(0)
 add  r4,r2,r3
 add  r5,r2,r4

= /asm

= mdopts

 instr-offset: 0x10010

= /mdopts

# <GEN>
MD n=Mem ra=0x00010010 d=0x80201000	#	lwz  r1,0x1000(0)
MD n=Mem ra=0x00010014 d=0x7C821A14	#	add  r4,r2,r3
MD n=Mem ra=0x00010018 d=0x7CA22214	#	add  r5,r2,r4
# </GEN>
CORE n=:P
# Protection-fault handler.
# addi  r31,r31,1
# mfspr r30,SRR0
# addi r30,r30,4
# mtspr SRR0,r30
# rfi
MD n=Mem ra=0x000A0000 d=0x3BFF0001	# addi r31,r31,1
MD n=Mem ra=0x000A0004 d=0x7FDA02A6	# mfspr r30,SRR0
MD n=Mem ra=0x000A0008 d=0x3BDE0004	# addi r30,r30,4
MD n=Mem ra=0x000A000c d=0x7FDA03A6	# mtspr SRR0,r30
MD n=Mem ra=0x000A0010 d=0x4C000064	# rfi

RD n=GPR i=1 d=0
RD n=GPR i=2 d=2
RD n=GPR i=3 d=3
RD n=MSR d=0x00700000
RD n=IVOR7 d=0x00000000
RD n=NIA   d=0x00000010

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=1 RPN=0x40 WIMG=0x1 EPN=0x0 SX=1 SR=1 SW=1 UX=1 UR=1 UW=1

# ea=0x0000 ra=0xA0000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x280 WIMG=0x1 EPN=0x0 SX=1

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=2 V=1 TID=0 SIZE=1 TS=1 RPN=0x284 WIMG=0x2 EPN=0x4 SX=0 SR=1 SW=0 UX=0 UR=0 UW=0 

TRACE


I ea=0x10 id=1
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x1 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0x80201000
INSTR op=0x80201000					asm="lwz r1,4096(r0)"
D n=Mem t=read ea=0x1000 nb=4
E n=ProtectionFault
R n=SRR0 d=0x00000010
R n=SRR1 d=0x00700000
R n=MSR d=0x00000000
R n=NIA d=0x00000000

I ea=0x0 id=2
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x280 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0xa0000 d=0x3bff0001
INSTR op=0x3bff0001					asm="addi r31,r31,1"
R n=GPR i=31 d=0x00000001

I ea=0x4 id=3
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x280 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0xa0004 d=0x7fda02a6
INSTR op=0x7fda02a6					asm="mfspr r30,SRR0"
R n=GPR i=30 d=0x00000010

I ea=0x8 id=4
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x280 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0xa0008 d=0x3bde0004
INSTR op=0x3bde0004					asm="addi r30,r30,4"
R n=GPR i=30 d=0x00000014

I ea=0xc id=5
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x280 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0xa000c d=0x7fda03a6
INSTR op=0x7fda03a6					asm="mtspr r30,SRR0"
R n=SRR0 d=0x00000014

I ea=0x10 id=6
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x280 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0xa0010 d=0x4c000064
INSTR op=0x4c000064					asm="rfi r0,r0,r0"
R n=MSR d=0x00700000
R n=NIA d=0x00000014

I ea=0x14 id=7
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x1 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x14 ra=0x10014 d=0x7c821a14
INSTR op=0x7c821a14					asm="add r4,r2,r3"
R n=GPR i=4 d=0x00000005

I ea=0x18 id=8
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x1 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x18 ra=0x10018 d=0x7ca22214
INSTR op=0x7ca22214					asm="add r5,r2,r4"
R n=GPR i=5 d=0x00000007

I ea=0x1c id=9
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x1 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x1c ra=0x1001c d=0x00000000
INSTR op=0x00					asm="halt "

RESULTS

RD n=GPR i=1 d=0
RD n=GPR i=2 d=2
RD n=GPR i=3 d=3
RD n=GPR i=4 d=5
RD n=GPR i=5 d=7
