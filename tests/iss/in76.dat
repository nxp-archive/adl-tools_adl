#
# Tests to make sure that multiple exceptions can be taken.
#
= asm

  addi r1,r1,1
  addi r2,r2,1
  .long 0xffffffff # This should cause a decode miss.
  mtspr DEC,r2
  addi r1,r1,1
  addi r2,r2,1
  addi r2,r2,1
  .long 0x0
  # Program interrupt handler.
  mfspr r10,SRR0
  addi r10,r10,4
  addi r30,r30,1
  mtspr SRR0,r10
  rfi
  .long 0x0
  # Decrementer interrupt handler.
  addi r31,r31,1
  rfci

= /asm

= aopts

  -mregnames -mbooke

= /aopts

# <GEN>
MD n=Mem ra=0x00000000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000004 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000008 d=0xFFFFFFFF	#	.long 0xffffffff # This should cause a decode miss.
MD n=Mem ra=0x0000000c d=0x7C5603A6	#	mtspr DEC,r2
MD n=Mem ra=0x00000010 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000014 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000018 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x0000001c d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000020 d=0x7D5A02A6	#	mfspr r10,SRR0
MD n=Mem ra=0x00000024 d=0x394A0004	#	addi r10,r10,4
MD n=Mem ra=0x00000028 d=0x3BDE0001	#	addi r30,r30,1
MD n=Mem ra=0x0000002c d=0x7D5A03A6	#	mtspr SRR0,r10
MD n=Mem ra=0x00000030 d=0x4C000064	#	rfi
MD n=Mem ra=0x00000034 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000038 d=0x3BFF0001	#	addi r31,r31,1
MD n=Mem ra=0x0000003c d=0x4C000066	#	rfci
# </GEN>

CORE n=:P
RD n=DEC    d=0x00000003
RD n=IVPR   d=0x00000000
RD n=IVOR6  d=0x00000020
RD n=IVOR10 d=0x00000038

RESULTS

RD n=GPR i=1 d=0x2
RD n=GPR i=2 d=0x3

RD n=GPR i=30 d=0x1
RD n=GPR i=31 d=0x2
