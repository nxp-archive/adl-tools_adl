#
# Test of a model with CGMT implemented using contexts.
# For this test, thread-swapping occurs due to the decrementer
# interrupt decrementing to 0.
#

= asm

  addi r2,r2,1
  addi r2,r2,1
  addi r2,r2,1
  addi r2,r2,1
  addi r2,r2,1
  addi r2,r2,1
  addi r2,r2,1
  .long 0
  addi r3,r3,1
  addi r3,r3,1
  addi r3,r3,1
  addi r3,r3,1
  addi r3,r3,1
  addi r3,r3,1
  addi r3,r3,1

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000004 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000008 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x0000000c d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000010 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000014 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000018 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x0000001c d=0x00000000	#	.long 0
MD n=Mem ra=0x00000020 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000024 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000028 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x0000002c d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000030 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000034 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000038 d=0x38630001	#	addi r3,r3,1
# </GEN>

CORE n=:P

CTX n=thread cn=0

RD n=DEC d=6
RD n=NIA d=0

CTX n=thread cn=1

RD n=DEC d=3
RD n=NIA d=0x20

CTX n=thread cn=0

TRACE

I ea=0x0 id=1
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000001

I ea=0x4 id=2
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000002

I ea=0x8 id=3
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000003
R n=TEN0 d=0x00000000
R n=TEN1 d=0x00000000
R n=TEN1 d=0x00000001
R n=TACTIVE d=0x00000001

CTX n=thread cn=1

I ea=0x20 id=4
M n=Mem t=ifetch ea=0x20 ra=0x20 d=0x38630001
INSTR op=0x38630001					asm="addi r3,r3,1"
R n=GPR i=3 d=0x00000001

I ea=0x24 id=5
M n=Mem t=ifetch ea=0x24 ra=0x24 d=0x38630001
INSTR op=0x38630001					asm="addi r3,r3,1"
R n=GPR i=3 d=0x00000002

I ea=0x28 id=6
M n=Mem t=ifetch ea=0x28 ra=0x28 d=0x38630001
INSTR op=0x38630001					asm="addi r3,r3,1"
R n=GPR i=3 d=0x00000003
R n=TEN0 d=0x00000000
R n=TEN1 d=0x00000000
R n=TEN0 d=0x00000001
R n=TACTIVE d=0x00000000

CTX n=thread cn=0

I ea=0xc id=7
M n=Mem t=ifetch ea=0xc ra=0xc d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000004

I ea=0x10 id=8
M n=Mem t=ifetch ea=0x10 ra=0x10 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000005

I ea=0x14 id=9
M n=Mem t=ifetch ea=0x14 ra=0x14 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000006

I ea=0x18 id=10
M n=Mem t=ifetch ea=0x18 ra=0x18 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000007

I ea=0x1c id=11
M n=Mem t=ifetch ea=0x1c ra=0x1c d=0x00000000
INSTR op=0x0					asm="halt "

RESULTS

CTX n=thread cn=0

RD n=GPR i=2 d=7

CTX n=thread cn=1

RD n=GPR i=3 d=3
