#
# Tests that alternate test-sets work properly with our
# address cache.
#

= asm

lwz   r2,0x1000(0)   # Initial load.
lwepx r3,r0,r10      # Load of same address w/alternate test-set.
lwepx r4,r0,r11      # Load of same address w/alternate test-set.
lwz   r5,0x1004(0)   # Load of same address w/normal test-set.
lwz   r6,0x1008(0)   # Load of same address w/normal test-set.
.long 0x0

= /asm

= aopts
  -mregnames -me500mc
= /aopts

= mdopts

instr-offset: 0x10000

= /mdopts

#
# <GEN>
MD n=Mem ra=0x00010000 d=0x80401000	#	lwz   r2,0x1000(0)   # Initial load.
MD n=Mem ra=0x00010004 d=0x7C60503E	#	lwepx r3,r0,r10      # Load of same address w/alternate test-set.
MD n=Mem ra=0x00010008 d=0x7C80583E	#	lwepx r4,r0,r11      # Load of same address w/alternate test-set.
MD n=Mem ra=0x0001000c d=0x80A01004	#	lwz   r5,0x1004(0)   # Load of same address w/normal test-set.
MD n=Mem ra=0x00010010 d=0x80C01008	#	lwz   r6,0x1008(0)   # Load of same address w/normal test-set.
MD n=Mem ra=0x00010014 d=0x00000000	#	.long 0x0
# </GEN>

CORE n=:P

RD n=MSR  d=0x00000000
RD n=PID0 d=0x00000001
RD n=ELPC d=0x0000000a
RD n=NIA  d=0x00000000

RD n=GPR i=10 d=0x1000
RD n=GPR i=11 d=0x1004

MD n=Mem ra=0x11000 d=0xdeadbeef
MD n=Mem ra=0x11004 d=0x12345678
MD n=Mem ra=0x11008 d=0xb0f0babe
MD n=Mem ra=0xb7000 d=0x87654321
MD n=Mem ra=0xb7004 d=0xa5a5a5a5

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0x1 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0x11000
TD n=TlbCam set=0 way=1 V=1 TID=0x1 SIZE=1 TS=0 RPN=0x44 WIMG=0x1 SX=1 SR=1 SW=1 EPN=4

# ea=0x3000 ra=0xA1000
TD n=TlbCam set=0 way=2 V=1 TID=0x1 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 SX=1 SR=1 SW=1 EPN=0xc

# ea=0x2000 ra=0xB2000
TD n=TlbCam set=0 way=3 V=1 TID=0x1 SIZE=1 TS=0 RPN=0x2c8 WIMG=0x3 SX=1 SR=1 SW=1 EPN=0x8

# ea=0x1000 ra=0xB7000
TD n=TlbCam set=0 way=4 V=1 TID=0xa SIZE=1 TS=0 RPN=0x2dc WIMG=0x4 SX=1 SR=1 SW=1 EPN=0x4

# ea=0x2000 ra=0xC2000
TD n=TlbCam set=0 way=5 V=1 TID=0xa SIZE=1 TS=0 RPN=0x308 WIMG=0x3 SX=1 SR=1 SW=1 EPN=0x8

TRACE

I ea=0x0 id=1
R n=HitReg d=0x00000001
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x80401000
INSTR op=0x80401000					asm="lwz r2,4096(r0)"
R n=NIA d=0x00000004
D n=Mem t=read ea=0x1000 nb=4
R n=HitReg d=0x00000002
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=read ea=0x1000 ra=0x11000 d=0xdeadbeef
R n=GPR i=2 d=0xdeadbeef

I ea=0x4 id=2
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x7c60503e
INSTR op=0x7c60503e					asm="lwepx r3,r0,r10"
R n=NIA d=0x00000008
D n=Mem t=read ea=0x1000 nb=4
R n=HitReg d=0x00000003
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x2dc SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0xa TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x4
M n=Mem t=read ea=0x1000 ra=0xb7000 d=0x87654321
R n=GPR i=3 d=0x87654321

I ea=0x8 id=3
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x7c80583e
INSTR op=0x7c80583e					asm="lwepx r4,r0,r11"
R n=NIA d=0x0000000c
D n=Mem t=read ea=0x1004 nb=4
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x2dc SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0xa TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x4
M n=Mem t=read ea=0x1004 ra=0xb7004 d=0xa5a5a5a5
R n=GPR i=4 d=0xa5a5a5a5

I ea=0xc id=4
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x80a01004
INSTR op=0x80a01004					asm="lwz r5,4100(r0)"
R n=NIA d=0x00000010
D n=Mem t=read ea=0x1004 nb=4
R n=HitReg d=0x00000004
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=read ea=0x1004 ra=0x11004 d=0x12345678
R n=GPR i=5 d=0x12345678

I ea=0x10 id=5
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0x80c01008
INSTR op=0x80c01008					asm="lwz r6,4104(r0)"
R n=NIA d=0x00000014
D n=Mem t=read ea=0x1008 nb=4
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=read ea=0x1008 ra=0x11008 d=0xb0f0babe
R n=GPR i=6 d=0xb0f0babe

I ea=0x14 id=6
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x1 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x14 ra=0x10014 d=0x00000000
INSTR op=0x00000000					asm="halt "
R n=NIA d=0x00000018

RESULTS

RD n=GPR i=2 d=0xdeadbeef
RD n=GPR i=3 d=0x87654321
RD n=GPR i=4 d=0xa5a5a5a5
RD n=GPR i=5 d=0x12345678
RD n=GPR i=6 d=0xb0f0babe

MD n=Mem ra=0x11000 d=0xdeadbeef
MD n=Mem ra=0x11004 d=0x12345678
MD n=Mem ra=0x11008 d=0xb0f0babe
MD n=Mem ra=0xb7000 d=0x87654321
MD n=Mem ra=0xb7004 d=0xa5a5a5a5
