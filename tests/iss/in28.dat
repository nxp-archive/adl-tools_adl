#
# Tests MMU permission checking and that we'll
# invalidate the MMU cache after a change to an
# MMU state register.
#
= asm

 lwz  r1,0x1000(0)
 lwz  r2,0x1100(0)
 lwz  r3,0x1200(0)
 mtmsr r20
 lwz  r4,0x1000(0)
 lwz  r5,0x1100(0)
 lwz  r6,0x1200(0)

= /asm

= mdopts

 instr-offset: 0x10000

= /mdopts

# <GEN>
MD n=Mem ra=0x00010000 d=0x80201000	#	lwz  r1,0x1000(0)
MD n=Mem ra=0x00010004 d=0x80401100	#	lwz  r2,0x1100(0)
MD n=Mem ra=0x00010008 d=0x80601200	#	lwz  r3,0x1200(0)
MD n=Mem ra=0x0001000c d=0x7E800124	#	mtmsr r20
MD n=Mem ra=0x00010010 d=0x80801000	#	lwz  r4,0x1000(0)
MD n=Mem ra=0x00010014 d=0x80A01100	#	lwz  r5,0x1100(0)
MD n=Mem ra=0x00010018 d=0x80C01200	#	lwz  r6,0x1200(0)
# </GEN>
CORE n=:P
# Protection-fault handler.
# addi  r31,r31,1
# mfspr r30,SRR0
# addi r30,r30,4
# mtspr SRR0,r30
# rfi
MD n=Mem ra=0x00010100 d=0x3BFF0001	# addi r31,r31,1
MD n=Mem ra=0x00010104 d=0x7FDA02A6	# mfspr r30,SRR0
MD n=Mem ra=0x00010108 d=0x3BDE0004	# addi r30,r30,4
MD n=Mem ra=0x0001010c d=0x7FDA03A6	# mtspr SRR0,r30
MD n=Mem ra=0x00010110 d=0x4C000064	# rfi

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=20 d=0x00000000
RD n=MSR d=0x00400000
RD n=IVOR7 d=0x00000100
RD n=NIA   d=0x00000000

MD n=Mem ra=0xA1000 d=0x1
MD n=Mem ra=0xA1100 d=0x2
MD n=Mem ra=0xA1200 d=0x3

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 EPN=0x0 SX=1 SR=1 SW=1 UX=1 UR=1 UW=1

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 EPN=0x4 SX=0 SR=1 SW=0 UR=0

TRACE

I id=1 ea=0x0
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x80201000
INSTR op=0x80201000 asm="#1 lwz 1,0,4096"
E n=ProtectionFault
R n=SRR0 d=0x00000000
R n=SRR1 d=0x00400000
R n=MSR d=0x00000000

I id=2 ea=0x100
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x100 ra=0x10100 d=0x3bff0001
INSTR op=0x3bff0001 asm="#2 addi 31,31,1"
R n=GPR i=31 d=0x00000001

I id=3 ea=0x104
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x104 ra=0x10104 d=0x7fda02a6
INSTR op=0x7fda02a6 asm="#3 mfspr 30,26"
R n=GPR i=30 d=0x00000000

I id=4 ea=0x108
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x108 ra=0x10108 d=0x3bde0004
INSTR op=0x3bde0004 asm="#4 addi 30,30,4"
R n=GPR i=30 d=0x00000004

I id=5 ea=0x10c
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10c ra=0x1010c d=0x7fda03a6
INSTR op=0x7fda03a6 asm="#5 mtspr 30,26"
R n=SRR0 d=0x00000004

I id=6 ea=0x110
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x110 ra=0x10110 d=0x4c000064
INSTR op=0x4c000064 asm="#6 rfi 0,0,0"
R n=MSR d=0x00400000

I id=7 ea=0x4
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x80401100
INSTR op=0x80401100 asm="#7 lwz 2,0,4352"
E n=ProtectionFault
R n=SRR0 d=0x00000004
R n=SRR1 d=0x00400000
R n=MSR d=0x00000000

I id=8 ea=0x100
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x100 ra=0x10100 d=0x3bff0001
INSTR op=0x3bff0001 asm="#8 addi 31,31,1"
R n=GPR i=31 d=0x00000002

I id=9 ea=0x104
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x104 ra=0x10104 d=0x7fda02a6
INSTR op=0x7fda02a6 asm="#9 mfspr 30,26"
R n=GPR i=30 d=0x00000004

I id=10 ea=0x108
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x108 ra=0x10108 d=0x3bde0004
INSTR op=0x3bde0004 asm="#10 addi 30,30,4"
R n=GPR i=30 d=0x00000008

I id=11 ea=0x10c
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10c ra=0x1010c d=0x7fda03a6
INSTR op=0x7fda03a6 asm="#11 mtspr 30,26"
R n=SRR0 d=0x00000008

I id=12 ea=0x110
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x110 ra=0x10110 d=0x4c000064
INSTR op=0x4c000064 asm="#12 rfi 0,0,0"
R n=MSR d=0x00400000

I id=13 ea=0x8
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x80601200
INSTR op=0x80601200 asm="#13 lwz 3,0,4608"
E n=ProtectionFault
R n=SRR0 d=0x00000008
R n=SRR1 d=0x00400000
R n=MSR d=0x00000000

I id=14 ea=0x100
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x100 ra=0x10100 d=0x3bff0001
INSTR op=0x3bff0001 asm="#14 addi 31,31,1"
R n=GPR i=31 d=0x00000003

I id=15 ea=0x104
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x104 ra=0x10104 d=0x7fda02a6
INSTR op=0x7fda02a6 asm="#15 mfspr 30,26"
R n=GPR i=30 d=0x00000008

I id=16 ea=0x108
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x108 ra=0x10108 d=0x3bde0004
INSTR op=0x3bde0004 asm="#16 addi 30,30,4"
R n=GPR i=30 d=0x0000000c

I id=17 ea=0x10c
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10c ra=0x1010c d=0x7fda03a6
INSTR op=0x7fda03a6 asm="#17 mtspr 30,26"
R n=SRR0 d=0x0000000c

I id=18 ea=0x110
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x110 ra=0x10110 d=0x4c000064
INSTR op=0x4c000064 asm="#18 rfi 0,0,0"
R n=MSR d=0x00400000

I id=19 ea=0xc
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x7e800124
INSTR op=0x7e800124 asm="#19 mtmsr 20"
R n=MSR d=0x00000000

I id=20 ea=0x10
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0x80801000
INSTR op=0x80801000 asm="#20 lwz 4,0,4096"
T n=TlbCam t=load  EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem ea=0x1000 ra=0xa1000 t=read d=0x00000001
R n=GPR i=4 d=0x00000001

I id=21 ea=0x14
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x14 ra=0x10014 d=0x80a01100
INSTR op=0x80a01100 asm="#21 lwz 5,0,4352"
T n=TlbCam t=load  EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem ea=0x1100 ra=0xa1100 t=read d=0x00000002
R n=GPR i=5 d=0x00000002

I id=22 ea=0x18
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x18 ra=0x10018 d=0x80c01200
INSTR op=0x80c01200 asm="#22 lwz 6,0,4608"
T n=TlbCam t=load  EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem ea=0x1200 ra=0xa1200 t=read d=0x00000003
R n=GPR i=6 d=0x00000003

I id=23 ea=0x1c
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x1c ra=0x1001c d=0x0
INSTR op=0x0 asm="#23 halt"

RESULTS

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=2 d=0
RD n=GPR i=3 d=0
RD n=GPR i=4 d=1
RD n=GPR i=5 d=2
RD n=GPR i=6 d=3
