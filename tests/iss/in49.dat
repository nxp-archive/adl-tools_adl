#
# Tests to make sure that if we disable a lower cache, then it's
# truly deactivated.
#

CORE n=:P
MD n=Mem ra=0x00000100 d=0x80401000	#	lwz    r2,0x1000(0)
MD n=Mem ra=0x00000104 d=0x90640000	#	stw    r3,0(r4)
MD n=Mem ra=0x00000108 d=0x90640004	#	stw    r3,4(r4)     # Should hit in the cache due to last access.
MD n=Mem ra=0x0000010c d=0x7E940AA6	#	mfspr  r20,52       # This will clear the cache enable bits.
MD n=Mem ra=0x00000110 d=0x56940080	#	rlwinm r20,r20,0,2,0 
MD n=Mem ra=0x00000114 d=0x7E940BA6	#	mtspr  52,r20
MD n=Mem ra=0x00000118 d=0x90640100	#	stw    r3,0x100(r4) # Should miss in L1 only b/c L2 is disabled.
# </GEN>

RD n=CCR d=0xc0000000
RD n=NIA d=0x0100
RD n=GPR i=3 d=0x12345678
RD n=GPR i=4 d=0x2000

MD n=Mem ra=0x1000 d=0xdeadbeef
MD n=Mem ra=0x2000 d=0x99999999
MD n=Mem ra=0x2004 d=0x99999999
MD n=Mem ra=0x2008 d=0x99999999
MD n=Mem ra=0x2100 d=0x99999999

TRACE

I ea=0x100 id=1
C n=L1i a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L1i a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x100 ra=0x100 d=0x80401000
INSTR op=0x80401000 asm="lwz 2,0,1000"
C n=L1d a=miss t=read set=32 way=0 lm=0x7f ra=0x1000
A l=1 m="L1d miss:  0x1000"
C n=L2 a=miss t=read set=32 way=0 lm=0x7f ra=0x1000
R n=CCR d=0xc0111000
C n=L2 a=load t=read set=32 way=0 lm=0x7f ra=0x1000
C n=L1d a=load t=read set=32 way=0 lm=0x7f ra=0x1000
M n=Mem t=read ea=0x1000 ra=0x1000 d=0xdeadbeef
R n=GPR i=2 d=0xdeadbeef

I ea=0x104 id=2
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x104 ra=0x104 d=0x90640000
INSTR op=0x90640000 asm="stw 3,4,0"
C n=L1d a=miss t=write set=0 way=0 lm=0x7f ra=0x2000
A l=1 m="L1d miss:  0x2000"
C n=L2 a=miss t=write set=64 way=0 lm=0x7f ra=0x2000
R n=CCR d=0xc0212000
C n=L2 a=load t=write set=64 way=0 lm=0x7f ra=0x2000
C n=L1d a=load t=write set=0 way=0 lm=0x7f ra=0x2000
M n=Mem t=write ea=0x2000 ra=0x2000 d=0x12345678

I ea=0x108 id=3
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x108 ra=0x108 d=0x90640004
INSTR op=0x90640004 asm="stw 3,4,4"
C n=L1d a=hit t=write set=0 way=0 lm=0x7f ra=0x2000
R n=CCR d=0xc1212000
M n=Mem t=write ea=0x2004 ra=0x2004 d=0x12345678

I ea=0x10c id=4
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x10c ra=0x10c d=0x7e940aa6
INSTR op=0x7e940aa6 asm="mfspr 14,34"
R n=GPR i=20 d=0xc1212000

I ea=0x110 id=5
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x110 ra=0x110 d=0x56940080
INSTR op=0x56940080 asm="rlwinm 14,14,0,2,0"
R n=GPR i=20 d=0x81212000

I ea=0x114 id=6
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x114 ra=0x114 d=0x7e940ba6
INSTR op=0x7e940ba6 asm="mtspr 14,34"
R n=CCR d=0x81212000

I ea=0x118 id=7
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x118 ra=0x118 d=0x90640100
INSTR op=0x90640100 asm="stw 3,4,100"
C n=L1d a=miss t=write set=2 way=0 lm=0x7f ra=0x2100
R n=CCR d=0x81312000
A l=1 m="L1d miss:  0x2100"
C n=L1d a=load t=write set=2 way=0 lm=0x7f ra=0x2100
M n=Mem t=write ea=0x2100 ra=0x2100 d=0x12345678

I ea=0x11c id=8
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x11c ra=0x11c d=0x0
INSTR op=0x0 asm="halt"

RESULTS

RD n=GPR i=2 d=0xdeadbeef
RD n=GPR i=3 d=0x12345678

CD n=L1d set=0 way=0 ra=0x0000000000002000 valid=1 dirty=1 locked=0 d=0x12345678,0x12345678,0x99999999,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=2 way=0 ra=0x0000000000002100 valid=1 dirty=1 locked=0 d=0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=32 way=0 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1i set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x80401000,0x90640000,0x90640004,0x7e940aa6,0x56940080,0x7e940ba6,0x90640100,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x80401000,0x90640000,0x90640004,0x7e940aa6,0x56940080,0x7e940ba6,0x90640100,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=32 way=0 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=64 way=0 ra=0x0000000000002000 valid=1 dirty=0 locked=0 d=0x99999999,0x99999999,0x99999999,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
