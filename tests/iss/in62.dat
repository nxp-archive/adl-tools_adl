#
# Tests the use of the search method on an MMU lookup.
#

= asm
  # First search is for 0x2000.  This should hit and the EPN, placed
  # into GPR10, should be 8.
  tlbsx r0,r4
  mfspr r5,200
  andi. r0,r5,0x2
  beq skip1
  srwi r10,r5,8
skip1:
  # Search for 0x4000.  This should miss.
  li 4,0x4000
  tlbsx r0,r4
  mfspr r5,200
  andi. r0,r5,0x2
  beq skip2
  srwi r11,r5,8
skip2:
  .long 0
= /asm

= aopts
  -mbooke -mregnames
= /aopts

= mdopts
 instr-offset: 0x10000
= /mdopts

# <GEN>
MD n=Mem ra=0x00010000 d=0x7C002724	#	tlbsx r0,r4
MD n=Mem ra=0x00010004 d=0x7CA832A6	#	mfspr r5,200
MD n=Mem ra=0x00010008 d=0x70A00002	#	andi. r0,r5,0x2
MD n=Mem ra=0x0001000c d=0x41820008	#	beq skip1
MD n=Mem ra=0x00010010 d=0x54AAC23E	#	srwi r10,r5,8
MD n=Mem ra=0x00010014 d=0x38804000	#	li 4,0x4000
MD n=Mem ra=0x00010018 d=0x7C002724	#	tlbsx r0,r4
MD n=Mem ra=0x0001001c d=0x7CA832A6	#	mfspr r5,200
MD n=Mem ra=0x00010020 d=0x70A00002	#	andi. r0,r5,0x2
MD n=Mem ra=0x00010024 d=0x41820008	#	beq skip2
MD n=Mem ra=0x00010028 d=0x54ABC23E	#	srwi r11,r5,8
MD n=Mem ra=0x0001002c d=0x00000000	#	.long 0
# </GEN>
CORE n=:P
RD n=GPR i=1 d=0x1fff
RD n=GPR i=4 d=0x2000
RD n=NIA     d=0x00000000

MD n=Mem ra=0xa1000 d=0xdeadbeef
MD n=Mem ra=0xb2000 d=0x00000000
MD n=Mem ra=0xb2ffc d=0x00000000
MD n=Mem ra=0xb7000 d=0x00000000

RD n=MSR d=0x00080000

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 SX=1 SR=1 SW=1 EPN=0x4

# ea=0x2000 ra=0xB2000
TD n=TlbCam set=0 way=2 V=1 TID=0 SIZE=1 TS=0 RPN=0x2c8 WIMG=0x3 SX=1 SR=1 SW=1 EPN=0x8

# ea=0x3000 ra=0xB7000
TD n=TlbCam set=0 way=3 V=1 TID=0 SIZE=1 TS=0 RPN=0x2dc WIMG=0x4 SX=1 SR=1 SW=1 EPN=0xc

TRACE


I ea=0x0 id=1
R n=HitReg d=0x00000001
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x7c002724
INSTR op=0x7c002724					asm="tlbsx  r0,r4"
R n=MAS0 d=0x00000802
R n=MAS0 d=0x00000802
R n=MAS1 d=0x0002c804
R n=MAS2 d=0xe0c00000

I ea=0x4 id=2
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x7ca832a6
INSTR op=0x7ca832a6					asm="mfspr  r5,200"
R n=GPR i=5 d=0x00000802

I ea=0x8 id=3
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x70a00002
INSTR op=0x70a00002					asm="andi.  r5,r0,0x2"
R n=GPR i=0 d=0x00000002
R n=CR d=0x40000000

I ea=0xc id=4
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x41820008
INSTR op=0x41820008					asm="beq-   0x0000000000000014"

I ea=0x10 id=5
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0x54aac23e
INSTR op=0x54aac23e					asm="rlwinm r10,r5,24,8,31"
R n=GPR i=10 d=0x00000008

I ea=0x14 id=6
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x14 ra=0x10014 d=0x38804000
INSTR op=0x38804000					asm="li     r4,16384"
R n=GPR i=4 d=0x00004000

I ea=0x18 id=7
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x18 ra=0x10018 d=0x7c002724
INSTR op=0x7c002724					asm="tlbsx  r0,r4"
R n=MAS0 d=0x00000800

I ea=0x1c id=8
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x1c ra=0x1001c d=0x7ca832a6
INSTR op=0x7ca832a6					asm="mfspr  r5,200"
R n=GPR i=5 d=0x00000800

I ea=0x20 id=9
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x20 ra=0x10020 d=0x70a00002
INSTR op=0x70a00002					asm="andi.  r5,r0,0x2"
R n=GPR i=0 d=0x00000000
R n=CR d=0x20000000

I ea=0x24 id=10
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x24 ra=0x10024 d=0x41820008
INSTR op=0x41820008					asm="beq-   0x000000000000002c"

I ea=0x2c id=11
T n=TlbCam t=instr  EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x2c ra=0x1002c d=0x00000000
INSTR op=0x0					asm="halt   "

RESULTS

RD n=GPR i=10 d=8
RD n=GPR i=11 d=0

