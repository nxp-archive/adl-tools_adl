#
# This tests to make sure that if we do a tlbwe to a translation that's
# currently being used (and thus cached), we will correctly clear the
# cache so that the behavior is consistent with what you would expect
# from an ISS.
#

= asm

  lwz r1,0x1000(0)
  tlbwe
  lwz r2,0x1000(0)

= /asm

= aopts
  -mregnames -me500
= /aopts
 
= mdopts

 instr-offset: 0x10000

= /mdopts

# <GEN>
MD n=Mem ra=0x00010000 d=0x80201000	#	lwz r1,0x1000(0)
MD n=Mem ra=0x00010004 d=0x7C0007A4	#	tlbwe
MD n=Mem ra=0x00010008 d=0x80401000	#	lwz r2,0x1000(0)
# </GEN>

CORE n=:P

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 EPN=0x0 SX=1 SR=1 SW=1

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 EPN=0x4 SX=1 SR=1 SW=1

RD n=MAS0 d=0x00000402
RD n=MAS1 d=0x0002c404
RD n=MAS2 d=0xE0000001

RD n=NIA   d=0x00000000

MD n=Mem ra=0xA1000 d=0x12345678
MD n=Mem ra=0xB1000 d=0xdeadbeef

TRACE


I ea=0x0 id=1
R n=HitReg d=0x00000001
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x80201000
INSTR op=0x80201000                                     asm="lwz r1,4096(r0)"
D n=Mem t=read ea=0x1000 nb=4
R n=HitReg d=0x00000002
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem t=read ea=0x1000 ra=0xa1000 d=0x12345678
R n=GPR i=1 d=0x12345678

I ea=0x4 id=2
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x7c0007a4
INSTR op=0x7c0007a4                                     asm="tlbwe "
T n=TlbCam t=write set=0 way=1  E=0x0 EPN=0x4 RPN=0x2c4 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0

I ea=0x8 id=3
R n=HitReg d=0x00000003
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x80401000
INSTR op=0x80401000                                     asm="lwz r2,4096(r0)"
D n=Mem t=read ea=0x1000 nb=4
R n=HitReg d=0x00000004
T n=TlbCam t=load  E=0x0 EPN=0x4 RPN=0x2c4 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=read ea=0x1000 ra=0xb1000 d=0xdeadbeef
R n=GPR i=2 d=0xdeadbeef

I ea=0xc id=4
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x00000000
INSTR op=0x00                                   asm="halt "

RESULTS

RD n=GPR i=1 d=0x12345678
RD n=GPR i=2 d=0xdeadbeef
