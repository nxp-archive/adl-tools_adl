#
# More victim cache testing.  We want to make sure that on misses,
# we only report the L1's behavior if we also miss in the L2.  If
# we hit in the L2, then we do report that.  So, a victim cache's
# access looks like:
#
# L1 miss    // Miss in L1 and L2, read from memory.
# 
# or
#
# L1 miss   // Miss in L1 but hit in L2.
# L2 hit
#

CORE n=:P

= asm

	lwz r2,0(r20)
	addi r20,r20,0x2000
	lwz r3,0(r20)
	lwz r4,0(r21)
	lwz r5,4(r21)

= /asm

= mdopts

 instr-offset: 0x100

= /mdopts

# <GEN>
MD n=Mem ra=0x00000100 d=0x80540000	#	lwz r2,0(r20)
MD n=Mem ra=0x00000104 d=0x3A942000	#	addi r20,r20,0x2000
MD n=Mem ra=0x00000108 d=0x80740000	#	lwz r3,0(r20)
MD n=Mem ra=0x0000010c d=0x80950000	#	lwz r4,0(r21)
MD n=Mem ra=0x00000110 d=0x80B50004	#	lwz r5,4(r21)
# </GEN>

RD n=NIA d=0x0100

RD n=CCR d=0xc0000000

RD n=GPR i=20 d=0x2000
RD n=GPR i=21 d=0x3000

MD n=Mem ra=0x2000 d=0x12345678
MD n=Mem ra=0x4000 d=0x87654321
MD n=Mem ra=0x3000 d=0x00000000
MD n=Mem ra=0x3004 d=0x00000000

CD n=L2 set=96 way=0 ra=0x0000000000003000 valid=1 dirty=1 d=0x99999999,0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

TRACE

I ea=0x100 id=1
C n=L1i a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=miss t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L2 a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
C n=L1i a=load t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x100 ra=0x100 d=0x80540000
INSTR op=0x80540000 asm="lwz 2,14,0"
C n=L1d a=miss t=read set=0 way=0 lm=0x7f ra=0x2000
C n=L2 a=miss t=read lm=0x7f ra=0x2000
C n=L1d a=load t=read set=0 way=0 lm=0x7f ra=0x2000
M n=Mem t=read ea=0x2000 ra=0x2000 d=0x12345678
R n=GPR i=2 d=0x12345678

I ea=0x104 id=2
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x104 ra=0x104 d=0x3a942000
INSTR op=0x3a942000 asm="addi 14,14,2000"
R n=GPR i=20 d=0x00004000

I ea=0x108 id=3
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x108 ra=0x108 d=0x80740000
INSTR op=0x80740000 asm="lwz 3,14,0"
C n=L1d a=miss t=read set=0 way=1 lm=0x7f ra=0x4000
C n=L2 a=miss t=read lm=0x7f ra=0x4000
C n=L1d a=load t=read set=0 way=1 lm=0x7f ra=0x4000
M n=Mem t=read ea=0x4000 ra=0x4000 d=0x87654321
R n=GPR i=3 d=0x87654321

I ea=0x10c id=4
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x10c ra=0x10c d=0x80950000
INSTR op=0x80950000 asm="lwz 4,15,0"
C n=L1d a=miss t=read set=32 way=0 lm=0x7f ra=0x3000
C n=L2 a=hit t=read set=96 way=0 lm=0x7f ra=0x3000
C n=L1d a=load t=read set=32 way=0 lm=0x7f ra=0x3000
M n=Mem t=read ea=0x3000 ra=0x3000 d=0x99999999
R n=GPR i=4 d=0x99999999

I ea=0x110 id=5
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x110 ra=0x110 d=0x80b50004
INSTR op=0x80b50004 asm="lwz 5,15,4"
C n=L1d a=hit t=read set=32 way=0 lm=0x7f ra=0x3000
M n=Mem t=read ea=0x3004 ra=0x3004 d=0xdeadbeef
R n=GPR i=5 d=0xdeadbeef

I ea=0x114 id=6
C n=L1i a=hit t=ifetch set=2 way=0 lm=0x7f ra=0x100
M n=Mem t=ifetch ea=0x114 ra=0x114 d=0x0
INSTR op=0x0 asm="halt"

RESULTS

CD n=L1d set=0 way=0 ra=0x0000000000002000 valid=1 dirty=0 locked=0 d=0x12345678,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=0 way=1 ra=0x0000000000004000 valid=1 dirty=0 locked=0 d=0x87654321,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1d set=32 way=0 ra=0x0000000000003000 valid=1 dirty=0 locked=0 d=0x99999999,0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

CD n=L2 set=96 way=0 ra=0x0000000000003000 valid=1 dirty=1 locked=0 d=0x99999999,0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

RD n=GPR i=2  d=0x12345678
RD n=GPR i=3  d=0x87654321
RD n=GPR i=4  d=0x99999999
RD n=GPR i=5  d=0xdeadbeef

