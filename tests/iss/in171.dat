#
# Checks to make sure that we virtualize parameters in memory read/write hooks
# so that the DMI cache does not become confused.
#
= asm

  lwz r1,0x1000(r0) # Load from big-endian- should go into cache.
  lwz r2,0x2000(r0) # Load from little-endian.
  lwz r3,0x1004(r0) # Load from big-endian- should be in the cache.
  lwz r4,0x2004(r0) # Load from little-endian- should be in the cache.
  stw r1,0x1008(r0) # Store to big-endian.
  stw r2,0x2008(r0) # Store to little-endian.
  stw r3,0x100c(r0) # Store to big-endian.
  stw r4,0x200c(r0) # Store to little-endian.

= /asm

CORE n=:P

# <GEN>
MD n=Mem ra=0x00000000 d=0x80201000	#	lwz r1,0x1000(r0) # Load from big-endian- should go into cache.
MD n=Mem ra=0x00000004 d=0x80402000	#	lwz r2,0x2000(r0) # Load from little-endian.
MD n=Mem ra=0x00000008 d=0x80601004	#	lwz r3,0x1004(r0) # Load from big-endian- should be in the cache.
MD n=Mem ra=0x0000000c d=0x80802004	#	lwz r4,0x2004(r0) # Load from little-endian- should be in the cache.
MD n=Mem ra=0x00000010 d=0x90201008	#	stw r1,0x1008(r0) # Store to big-endian.
MD n=Mem ra=0x00000014 d=0x90402008	#	stw r2,0x2008(r0) # Store to little-endian.
MD n=Mem ra=0x00000018 d=0x9060100C	#	stw r3,0x100c(r0) # Store to big-endian.
MD n=Mem ra=0x0000001c d=0x9080200C	#	stw r4,0x200c(r0) # Store to little-endian.
# </GEN>

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0 WIMG=0x1 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 SX=1 SR=1 SW=1 EPN=0x4

# ea=0x2000 ra=0xB2000
TD n=TlbCam set=0 way=2 V=1 TID=0 SIZE=1 TS=0 RPN=0x2c8 WIMG=0x3 SX=1 SR=1 SW=1 EPN=0x8 E=0x1

RD n=NIA d=0x00000000

MD n=Mem ra=0xa1000 d=0xdeadbeef
MD n=Mem ra=0xa1004 d=0x12345678
MD n=Mem ra=0xa1008 d=0x00000000
MD n=Mem ra=0xa100c d=0x00000000

MD n=Mem ra=0xb2000 d=0xb0f0babe
MD n=Mem ra=0xb2004 d=0xb06f6327
MD n=Mem ra=0xb2008 d=0x00000000
MD n=Mem ra=0xb200c d=0x00000000

RESULTS

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=2 d=0xbebaf0b0
RD n=GPR i=3 d=0x12345678
RD n=GPR i=4 d=0x27636fb0

MD n=Mem ra=0xa1000 d=0xdeadbeef
MD n=Mem ra=0xa1004 d=0x12345678
MD n=Mem ra=0xa1008 d=0xdeadbeef
MD n=Mem ra=0xa100c d=0x12345678

MD n=Mem ra=0xb2000 d=0xb0f0babe
MD n=Mem ra=0xb2004 d=0xb06f6327
MD n=Mem ra=0xb2008 d=0xb0f0babe
MD n=Mem ra=0xb200c d=0xb06f6327
