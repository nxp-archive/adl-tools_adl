#
# Tests that stores which cross pages, where the second portion of the store
# causes a protection fault, will be partially executed.  In this case, the
# second store will write to bytes 0xa1ffe and 0xa1fff, but not to 0xb2000 or 0xb2001.
#

= asm

stw r1,0x1ff0(0)
stw r2,0x1ffe(0)
stw r3,0x2000(0)
lwz r4,0x2000(0)
.long 0
.long 0
.long 0
.long 0
addi  r31,r31,1
mfspr r30,SRR0
addi r30,r30,4
mtspr SRR0,r30
rfi

= /asm

= mdopts

instr-offset: 0x10000

= /mdopts

# <GEN>
MD n=Mem ra=0x00010000 d=0x90201FF0	#	stw r1,0x1ff0(0)
MD n=Mem ra=0x00010004 d=0x90401FFE	#	stw r2,0x1ffe(0)
MD n=Mem ra=0x00010008 d=0x90602000	#	stw r3,0x2000(0)
MD n=Mem ra=0x0001000c d=0x80802000	#	lwz r4,0x2000(0)
MD n=Mem ra=0x00010010 d=0x00000000	#	.long 0
MD n=Mem ra=0x00010014 d=0x00000000	#	.long 0
MD n=Mem ra=0x00010018 d=0x00000000	#	.long 0
MD n=Mem ra=0x0001001c d=0x00000000	#	.long 0
MD n=Mem ra=0x00010020 d=0x3BFF0001	#	addi  r31,r31,1
MD n=Mem ra=0x00010024 d=0x7FDA02A6	#	mfspr r30,SRR0
MD n=Mem ra=0x00010028 d=0x3BDE0004	#	addi r30,r30,4
MD n=Mem ra=0x0001002c d=0x7FDA03A6	#	mtspr SRR0,r30
MD n=Mem ra=0x00010030 d=0x4C000064	#	rfi
# </GEN>

RD n=IVOR7 d=0x100020
RD n=NIA   d=0x00000000

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=2 d=0x12345678
RD n=GPR i=3 d=0xb0f0babe

MD n=Mem ra=0xa1ff0 d=0x00000000
MD n=Mem ra=0xa1ffc d=0x00000000
MD n=Mem ra=0xb2000 d=0xf00fa5a5

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0xA1000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 SX=1 SR=1 SW=1 EPN=0x4

# ea=0x2000 ra=0xB2000
TD n=TlbCam set=0 way=2 V=1 TID=0 SIZE=1 TS=0 RPN=0x2c8 WIMG=0x3 SX=0 SR=1 SW=0 EPN=0x8

CORE n=:P

TRACE

I ea=0x0 id=1
R n=HitReg d=0x00000001
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x90201ff0
INSTR op=0x90201ff0					asm="stw r1,8176(r0)"
D n=Mem t=write ea=0x1ff0 nb=4
R n=HitReg d=0x00000002
T n=TlbCam t=store  E=0x0 EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem t=write ea=0x1ff0 ra=0xa1ff0 d=0xdeadbeef

I ea=0x4 id=2
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x90401ffe
INSTR op=0x90401ffe					asm="stw r2,8190(r0)"
D n=Mem t=write ea=0x1ffe nb=4
T n=TlbCam t=store  E=0x0 EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
T n=TlbCam t=store  E=0x0 EPN=0x8 RPN=0x2c8 SIZE=0x1 SR=0x1 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x3
M n=Mem t=write ea=0x1ffc ra=0xa1ffc d=0x00001234
E n=ProtectionFault
R n=SRR0 d=0x00000004
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000

I ea=0x20 id=3
R n=HitReg d=0x00000003
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x20 ra=0x10020 d=0x3bff0001
INSTR op=0x3bff0001					asm="addi r31,r31,1"
R n=GPR i=31 d=0x00000001

I ea=0x24 id=4
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x24 ra=0x10024 d=0x7fda02a6
INSTR op=0x7fda02a6					asm="mfspr r30,26"
R n=GPR i=30 d=0x00000004

I ea=0x28 id=5
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x28 ra=0x10028 d=0x3bde0004
INSTR op=0x3bde0004					asm="addi r30,r30,4"
R n=GPR i=30 d=0x00000008

I ea=0x2c id=6
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x2c ra=0x1002c d=0x7fda03a6
INSTR op=0x7fda03a6					asm="mtspr r30,26"
R n=SRR0 d=0x00000008

I ea=0x30 id=7
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x30 ra=0x10030 d=0x4c000064
INSTR op=0x4c000064					asm="rfi r0,r0,r0"
R n=MSR d=0x00000000

I ea=0x8 id=8
R n=HitReg d=0x00000004
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x90602000
INSTR op=0x90602000					asm="stw r3,8192(r0)"
D n=Mem t=write ea=0x2000 nb=4
E n=ProtectionFault
R n=SRR0 d=0x00000008
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000

I ea=0x20 id=9
R n=HitReg d=0x00000005
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x20 ra=0x10020 d=0x3bff0001
INSTR op=0x3bff0001					asm="addi r31,r31,1"
R n=GPR i=31 d=0x00000002

I ea=0x24 id=10
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x24 ra=0x10024 d=0x7fda02a6
INSTR op=0x7fda02a6					asm="mfspr r30,26"
R n=GPR i=30 d=0x00000008

I ea=0x28 id=11
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x28 ra=0x10028 d=0x3bde0004
INSTR op=0x3bde0004					asm="addi r30,r30,4"
R n=GPR i=30 d=0x0000000c

I ea=0x2c id=12
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x2c ra=0x1002c d=0x7fda03a6
INSTR op=0x7fda03a6					asm="mtspr r30,26"
R n=SRR0 d=0x0000000c

I ea=0x30 id=13
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x30 ra=0x10030 d=0x4c000064
INSTR op=0x4c000064					asm="rfi r0,r0,r0"
R n=MSR d=0x00000000

I ea=0xc id=14
R n=HitReg d=0x00000006
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x80802000
INSTR op=0x80802000					asm="lwz r4,8192(r0)"
D n=Mem t=read ea=0x2000 nb=4
R n=HitReg d=0x00000007
T n=TlbCam t=load  E=0x0 EPN=0x8 RPN=0x2c8 SIZE=0x1 SR=0x1 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x3
M n=Mem t=read ea=0x2000 ra=0xb2000 d=0xf00fa5a5
R n=GPR i=4 d=0xf00fa5a5

I ea=0x10 id=15
T n=TlbCam t=instr  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0x00000000
INSTR op=0x00					asm="halt "

RESULTS

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=2 d=0x12345678
RD n=GPR i=3 d=0xb0f0babe
RD n=GPR i=4 d=0xf00fa5a5

MD n=Mem ra=0x00000000000a1ff0 d=0xdeadbeef
MD n=Mem ra=0x00000000000a1ffc d=0x00001234
MD n=Mem ra=0x00000000000b2000 d=0xf00fa5a5
