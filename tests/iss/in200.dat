#
# Checks to make sure that, for an MP test with register-read logging on, we
# don't log the read of NIA for setting the CIA.  Since that happens before
# log_instr_prefetch, this would erroneously be considered part of the last
# instruction and thus appear as an NIA read for the prior core (for MP).
#
= asm

	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	.long 0x0
	addi r2,r2,1
	addi r2,r2,1
	addi r2,r2,1

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000004 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000008 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000000c d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000010 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000014 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000018 d=0x38420001	#	addi r2,r2,1
# </GEN>

CORE n=:procs:P0

RD n=NIA d=0x0

CORE n=:procs:P1

RD n=NIA d=0x10

TRACE

CORE n=:procs:P0


I ea=0x0 id=1
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x38210001
INSTR op=0x38210001					asm="addi 1,1,0x1"
R n=NIA d=0x00000004
R a=read n=GPR i=1 d=0x00000000
R n=GPR i=1 d=0x00000001

CORE n=:procs:P1


I ea=0x10 id=2
M n=Mem t=ifetch ea=0x10 ra=0x10 d=0x38420001
INSTR op=0x38420001					asm="addi 2,2,0x1"
R n=NIA d=0x00000014
R a=read n=GPR i=2 d=0x00000000
R n=GPR i=2 d=0x00000001
R a=read n=PCEXCPT d=0x00000000

CORE n=:procs:P0


I ea=0x4 id=3
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x38210001
INSTR op=0x38210001					asm="addi 1,1,0x1"
R n=NIA d=0x00000008
R a=read n=GPR i=1 d=0x00000001
R n=GPR i=1 d=0x00000002
R a=read n=PCEXCPT d=0x00000000

CORE n=:procs:P1


I ea=0x14 id=4
M n=Mem t=ifetch ea=0x14 ra=0x14 d=0x38420001
INSTR op=0x38420001					asm="addi 2,2,0x1"
R n=NIA d=0x00000018
R a=read n=GPR i=2 d=0x00000001
R n=GPR i=2 d=0x00000002

CORE n=:procs:P0


I ea=0x8 id=5
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x38210001
INSTR op=0x38210001					asm="addi 1,1,0x1"
R n=NIA d=0x0000000c
R a=read n=GPR i=1 d=0x00000002
R n=GPR i=1 d=0x00000003

CORE n=:procs:P1


I ea=0x18 id=6
M n=Mem t=ifetch ea=0x18 ra=0x18 d=0x38420001
INSTR op=0x38420001					asm="addi 2,2,0x1"
R n=NIA d=0x0000001c
R a=read n=GPR i=2 d=0x00000002
R n=GPR i=2 d=0x00000003

CORE n=:procs:P0


I ea=0xc id=7
M n=Mem t=ifetch ea=0xc ra=0xc d=0x00000000
INSTR op=0x00000000					asm="halt "
R n=NIA d=0x00000010

CORE n=:procs:P1


I ea=0x1c id=8
M n=Mem t=ifetch ea=0x1c ra=0x1c d=0x00000000
INSTR op=0x00000000					asm="halt "
R n=NIA d=0x00000020

RESULTS

CORE n=:procs:P0

RD n=GPR i=1 d=0x00000003

CORE n=:procs:P1

RD n=GPR i=2 d=0x00000003
