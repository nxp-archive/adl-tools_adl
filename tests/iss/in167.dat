#
# Write-through cache lines should not be put into the DMI cache
# because we won't get the write-through behavior on subsequent hits.
#
= asm

  mtspr 52,r10      # Turn on write-through.
  stw r1,0x1000(r0) # Write through to memory.
  mtspr 52,r11      # Turn off write-through.
  stw r1,0x1004(r0) # Will hit in DMI cache.
  dcbf r0,r20       # Flush the line, which shouldn't matter, b/c it's write-through.
  lwz r2,0x1000(r0) # Should load 0xdeadbeef
  lwz r3,0x1004(r0) # Should load 0xdeadbeef

= /asm

CORE n=:P

# <GEN>
MD n=Mem ra=0x00000000 d=0x7D540BA6	#	mtspr 52,r10      # Turn on write-through.
MD n=Mem ra=0x00000004 d=0x90201000	#	stw r1,0x1000(r0) # Write through to memory.
MD n=Mem ra=0x00000008 d=0x90201004	#	stw r1,0x1004(r0) # Write through to memory.
MD n=Mem ra=0x0000000c d=0x7C00A0AC	#	dcbf r0,r20       # Flush the line, which shouldn't matter, b/c it's write-through.
MD n=Mem ra=0x00000010 d=0x80401000	#	lwz r2,0x1000(r0)
MD n=Mem ra=0x00000014 d=0x80601004	#	lwz r3,0x1004(r0)
# </GEN>

RD n=GPR i=10 d=0xc0000800
RD n=GPR i=11 d=0xc0000000
RD n=GPR i=20 d=0x00001000

RD n=GPR i=1  d=0xdeadbeef

RESULTS

RD n=GPR i=1  d=0xdeadbeef
RD n=GPR i=2  d=0xdeadbeef
RD n=GPR i=3  d=0xdeadbeef
