#
# This makes sure that, with the decode cache, we don't touch extra icache logic
# unless the cache is actually enabled.
#

= asm

	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	lis r2,0xc000 # Enable the cache.
	mtspr 52,r2
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1
	b L1					# Make sure that we touch the first cache line of a basic block.
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
L1:
	addi r1,r1,1
	addi r1,r1,1
	addi r1,r1,1

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000004 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000008 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000000c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000010 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000014 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000018 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000001c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000020 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000024 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000028 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000002c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000030 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000034 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000038 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000003c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000040 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000044 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000048 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000004c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000050 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000054 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000058 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000005c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000060 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000064 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000068 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000006c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000070 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000074 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000078 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000007c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000080 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000084 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000088 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000008c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000090 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000094 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000098 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000009c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000a0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000a4 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000a8 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000ac d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000b0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000b4 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000b8 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000bc d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000c0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000c4 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000c8 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000cc d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000d0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000d4 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000d8 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000dc d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000e0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000e4 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000e8 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000ec d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000f0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000f4 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x000000f8 d=0x3C40C000	#	lis r2,0xc000 # Enable the cache.
MD n=Mem ra=0x000000fc d=0x7C540BA6	#	mtspr 52,r2
MD n=Mem ra=0x00000100 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000104 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000108 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000010c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000110 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000114 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000118 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000011c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000120 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000124 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000128 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000012c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000130 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000134 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000138 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000013c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000140 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000144 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000148 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000014c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000150 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000154 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000158 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000015c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000160 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000164 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000168 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000016c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000170 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000174 d=0x48000020	#	b L1					# Make sure that we touch the first cache line of a basic block.
MD n=Mem ra=0x00000178 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x0000017c d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000180 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000184 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000188 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x0000018c d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000190 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00000194 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000198 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x0000019c d=0x38210001	#	addi r1,r1,1
# </GEN>

CORE n=:P

RESULTS

RD n=GPR i=1 d=94

# Note: We should only have sets 2 and 3.  Sets 0 and 1 are not present b/c
# their respective code was accessed with the cache off.
CD n=L1i set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x48000020,0x00000000,0x00000000
CD n=L1i set=3 way=0 ra=0x0000000000000180 valid=1 dirty=0 locked=0 d=0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x38210001,0x38210001,0x38210001,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L2 set=2 way=0 ra=0x0000000000000100 valid=1 dirty=0 locked=0 d=0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x38210001,0x48000020,0x00000000,0x00000000
CD n=L2 set=3 way=0 ra=0x0000000000000180 valid=1 dirty=0 locked=0 d=0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x38210001,0x38210001,0x38210001,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
