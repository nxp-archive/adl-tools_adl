#
# Tests that we set up the reset-state translation.
#

= asm

start:
 lwz  r1,0x1004(0)
 lwz  r2,0x1000(0)
 add  r3,r2,r1
 stw  r3,0x1008(0)
 .long 0
 b start

= /asm

= mdopts
  instr-offset: 0xfe8
= /mdopts

# <GEN>
MD n=Mem ra=0x00000fe8 d=0x80201004	#	lwz  r1,0x1004(0)
MD n=Mem ra=0x00000fec d=0x80401000	#	lwz  r2,0x1000(0)
MD n=Mem ra=0x00000ff0 d=0x7C620A14	#	add  r3,r2,r1
MD n=Mem ra=0x00000ff4 d=0x90601008	#	stw  r3,0x1008(0)
MD n=Mem ra=0x00000ff8 d=0x00000000	#	.long 0
MD n=Mem ra=0x00000ffc d=0x4BFFFFEC	#	b start
# </GEN>

MD n=Mem ra=0x1000 d=0xa
MD n=Mem ra=0x1004 d=0xb

CORE n=:P

TRACE

I ea=0xfffffffc id=1
R n=HitReg d=0x00000001
T n=TlbCam t=instr  EPN=0x3fffff RPN=0x0 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=ifetch ea=0xfffffffc ra=0xffc d=0x4bffffec
INSTR op=0x4bffffec                                     asm="b      0x00000000ffffffe8"

I ea=0xffffffe8 id=2
T n=TlbCam t=instr  EPN=0x3fffff RPN=0x0 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=ifetch ea=0xffffffe8 ra=0xfe8 d=0x80201004
INSTR op=0x80201004                                     asm="lwz    r1,4100(r0)"
D n=Mem t=read ea=0x1004 nb=4
T n=TlbCam t=load  EPN=0x0 RPN=0x4 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=read ea=0x1004 ra=0x1004 d=0x0000000b
R n=GPR i=1 d=0x0000000b

I ea=0xffffffec id=3
T n=TlbCam t=instr  EPN=0x3fffff RPN=0x0 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=ifetch ea=0xffffffec ra=0xfec d=0x80401000
INSTR op=0x80401000                                     asm="lwz    r2,4096(r0)"
D n=Mem t=read ea=0x1000 nb=4
T n=TlbCam t=load  EPN=0x0 RPN=0x4 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=read ea=0x1000 ra=0x1000 d=0x0000000a
R n=GPR i=2 d=0x0000000a

I ea=0xfffffff0 id=4
T n=TlbCam t=instr  EPN=0x3fffff RPN=0x0 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=ifetch ea=0xfffffff0 ra=0xff0 d=0x7c620a14
INSTR op=0x7c620a14                                     asm="add    r3,r2,r1"
R n=GPR i=3 d=0x00000015

I ea=0xfffffff4 id=5
T n=TlbCam t=instr  EPN=0x3fffff RPN=0x0 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=ifetch ea=0xfffffff4 ra=0xff4 d=0x90601008
INSTR op=0x90601008                                     asm="stw    r3,4104(r0)"
D n=Mem t=write ea=0x1008 nb=4
T n=TlbCam t=store  EPN=0x0 RPN=0x4 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=write ea=0x1008 ra=0x1008 d=0x00000015

I ea=0xfffffff8 id=6
T n=TlbCam t=instr  EPN=0x3fffff RPN=0x0 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x0
M n=Mem t=ifetch ea=0xfffffff8 ra=0xff8 d=0x00000000
INSTR op=0x0                                    asm="halt   "

RESULTS

MD n=Mem ra=0x1000 d=10
MD n=Mem ra=0x1004 d=11
MD n=Mem ra=0x1008 d=21
