#
# Checking of behavior for 0-entry, purely register-based TLBs with bounded
# checking.
#

= asm 

	lwz r1,0x100(r5)   # Hit in MPUREG, OK.
	lwz r2,0x200(r5)
	stw r2,0x200(r5)   # Permission fail.
	lwz r3,0x1000(r0)  # Hit in MPU.
	stw r3,0x1004(r0)  # Permission fail.
	stw r3,0x2000(r0)  # Hit in MPU, OK.
	.long 0x0
	# prot fault handler.
	addi r10,r10,1
	mfspr r31,SRR0
	addi  r31,r31,4
	mtspr SRR0,r31
	rfi	

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x80250100	#	lwz r1,0x100(r5)   # Hit in MPUREG, OK.
MD n=Mem ra=0x00000004 d=0x80450200	#	lwz r2,0x200(r5)
MD n=Mem ra=0x00000008 d=0x90450200	#	stw r2,0x200(r5)   # Permission fail.
MD n=Mem ra=0x0000000c d=0x80601000	#	lwz r3,0x1000(r0)  # Hit in MPU.
MD n=Mem ra=0x00000010 d=0x90601004	#	stw r3,0x1004(r0)  # Permission fail.
MD n=Mem ra=0x00000014 d=0x90602000	#	stw r3,0x2000(r0)  # Hit in MPU, OK.
MD n=Mem ra=0x00000018 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x0000001c d=0x394A0001	#	addi r10,r10,1
MD n=Mem ra=0x00000020 d=0x7FFA02A6	#	mfspr r31,SRR0
MD n=Mem ra=0x00000024 d=0x3BFF0004	#	addi  r31,r31,4
MD n=Mem ra=0x00000028 d=0x7FFA03A6	#	mtspr SRR0,r31
MD n=Mem ra=0x0000002c d=0x4C000064	#	rfi	
# </GEN>

CORE n=:P

RD n=IVOR7  d=0x1c
# Permissions for 0x100-0x300, allow reads but not writes.
RD n=MPUREG d=0x0103c001

RD n=GPR i=5 d=0x10000

TD n=MpuCam set=0 way=1 LB=0x1000 UB=0x1fff SR=1 SW=0 UR=1 UW=0 V=1
TD n=MpuCam set=0 way=2 LB=0x2000 UB=0x2fff SR=0 SW=1 UR=0 UW=1 V=1


MD n=Mem ra=0x10100 d=20
MD n=Mem ra=0x10200 d=30
MD n=Mem ra=0x1000  d=40
MD n=Mem ra=0x1004  d=0
MD n=Mem ra=0x2000  d=50

TRACE


I ea=0x0 id=1
T n=MpuCam t=instr set=0 way=0 ea=0x0 ra=0x0  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
A l=1 m="In addr-check."
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x80250100
INSTR op=0x80250100					asm="lwz r1,256(r5)"
D n=Mem t=read ea=0x10100 nb=4
T n=MpuReg t=load ea=0x10100 ra=0x10100 
A l=1 m="In addr-check."
M n=Mem t=read ea=0x10100 ra=0x10100 d=0x00000014
R n=GPR i=1 d=0x00000014

I ea=0x4 id=2
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x4 ra=0x4  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x80450200
INSTR op=0x80450200					asm="lwz r2,512(r5)"
D n=Mem t=read ea=0x10200 nb=4
A l=1 m="In addr-check."
T n=MpuReg t=load ea=0x10200 ra=0x10200 
M n=Mem t=read ea=0x10200 ra=0x10200 d=0x0000001e
R n=GPR i=2 d=0x0000001e

I ea=0x8 id=3
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x8 ra=0x8  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x90450200
INSTR op=0x90450200					asm="stw r2,512(r5)"
D n=Mem t=write ea=0x10200 nb=4
T n=MpuReg t=store ea=0x10200 ra=0x10200 
A l=1 m="In addr-check."
R n=ESR d=0x00010200
E n=ProtectionFault
R n=SRR0 d=0x00000008
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000
B taken=1 ea=0x1c

I ea=0x1c id=4
T n=MpuCam t=instr set=0 way=0 ea=0x1c ra=0x1c  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
A l=1 m="In addr-check."
M n=Mem t=ifetch ea=0x1c ra=0x1c d=0x394a0001
INSTR op=0x394a0001					asm="addi r10,r10,1"
R n=GPR i=10 d=0x00000001

I ea=0x20 id=5
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x20 ra=0x20  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x20 ra=0x20 d=0x7ffa02a6
INSTR op=0x7ffa02a6					asm="mfspr r31,SRR0"
R n=GPR i=31 d=0x00000008

I ea=0x24 id=6
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x24 ra=0x24  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x24 ra=0x24 d=0x3bff0004
INSTR op=0x3bff0004					asm="addi r31,r31,4"
R n=GPR i=31 d=0x0000000c

I ea=0x28 id=7
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x28 ra=0x28  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x28 ra=0x28 d=0x7ffa03a6
INSTR op=0x7ffa03a6					asm="mtspr SRR0,r31"
R n=SRR0 d=0x0000000c

I ea=0x2c id=8
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x2c ra=0x2c  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x2c ra=0x2c d=0x4c000064
INSTR op=0x4c000064					asm="rfi r0,r0,r0"
R n=MSR d=0x00000000
B taken=1 ea=0xc

I ea=0xc id=9
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0xc ra=0xc  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0xc ra=0xc d=0x80601000
INSTR op=0x80601000					asm="lwz r3,4096(r0)"
D n=Mem t=read ea=0x1000 nb=4
T n=MpuCam t=load set=0 way=1 ea=0x1000 ra=0x1000  IR=0x0 LB=0x1000 SR=0x1 SW=0x0 SX=0x0 UB=0x1fff UM=0x0 UR=0x1 UW=0x0 UX=0x0 V=0x1
A l=1 m="In addr-check."
M n=Mem t=read ea=0x1000 ra=0x1000 d=0x00000028
R n=GPR i=3 d=0x00000028

I ea=0x10 id=10
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x10 ra=0x10  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10 d=0x90601004
INSTR op=0x90601004					asm="stw r3,4100(r0)"
D n=Mem t=write ea=0x1004 nb=4
T n=MpuCam t=store set=0 way=1 ea=0x1004 ra=0x1004  IR=0x0 LB=0x1000 SR=0x1 SW=0x0 SX=0x0 UB=0x1fff UM=0x0 UR=0x1 UW=0x0 UX=0x0 V=0x1
A l=1 m="In addr-check."
R n=ESR d=0x00001004
E n=ProtectionFault
R n=SRR0 d=0x00000010
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000
B taken=1 ea=0x1c

I ea=0x1c id=11
T n=MpuCam t=instr set=0 way=0 ea=0x1c ra=0x1c  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
A l=1 m="In addr-check."
M n=Mem t=ifetch ea=0x1c ra=0x1c d=0x394a0001
INSTR op=0x394a0001					asm="addi r10,r10,1"
R n=GPR i=10 d=0x00000002

I ea=0x20 id=12
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x20 ra=0x20  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x20 ra=0x20 d=0x7ffa02a6
INSTR op=0x7ffa02a6					asm="mfspr r31,SRR0"
R n=GPR i=31 d=0x00000010

I ea=0x24 id=13
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x24 ra=0x24  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x24 ra=0x24 d=0x3bff0004
INSTR op=0x3bff0004					asm="addi r31,r31,4"
R n=GPR i=31 d=0x00000014

I ea=0x28 id=14
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x28 ra=0x28  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x28 ra=0x28 d=0x7ffa03a6
INSTR op=0x7ffa03a6					asm="mtspr SRR0,r31"
R n=SRR0 d=0x00000014

I ea=0x2c id=15
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x2c ra=0x2c  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x2c ra=0x2c d=0x4c000064
INSTR op=0x4c000064					asm="rfi r0,r0,r0"
R n=MSR d=0x00000000
B taken=1 ea=0x14

I ea=0x14 id=16
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x14 ra=0x14  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x14 ra=0x14 d=0x90602000
INSTR op=0x90602000					asm="stw r3,8192(r0)"
D n=Mem t=write ea=0x2000 nb=4
T n=MpuCam t=store set=0 way=2 ea=0x2000 ra=0x2000  IR=0x0 LB=0x2000 SR=0x0 SW=0x1 SX=0x0 UB=0x2fff UM=0x0 UR=0x0 UW=0x1 UX=0x0 V=0x1
A l=1 m="In addr-check."
M n=Mem t=write ea=0x2000 ra=0x2000 d=0x00000028

I ea=0x18 id=17
A l=1 m="In addr-check."
T n=MpuCam t=instr set=0 way=0 ea=0x18 ra=0x18  IR=0x0 LB=0x0 SR=0x1 SW=0x1 SX=0x1 UB=0xfff UM=0x0 UR=0x1 UW=0x1 UX=0x1 V=0x1
M n=Mem t=ifetch ea=0x18 ra=0x18 d=0x00000000
INSTR op=0x00000000					asm="halt "

RESULTS

RD n=GPR i=1  d=20
RD n=GPR i=2  d=30
RD n=GPR i=3  d=40
RD n=GPR i=10 d=2

MD n=Mem ra=0x10100 d=20
MD n=Mem ra=0x10200 d=30
MD n=Mem ra=0x1000  d=40
MD n=Mem ra=0x1004  d=0
MD n=Mem ra=0x2000  d=40
