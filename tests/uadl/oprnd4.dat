#
# Test mt/mfspr for a register with a write hook to make sure that we don't get
# into an infinite recursion issue due to the register's write-hook referencing
# itself.
#
= asm

	mtspr 211,r9
	mfspr r10,211
	addi r10,r10,0x70
	mtspr 211,r10
	mfspr r11,211	

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x7D3333A6	#	mtspr 211,r9
MD n=Mem ra=0x00000004 d=0x7D5332A6	#	mfspr r10,211
MD n=Mem ra=0x00000008 d=0x394A0070	#	addi r10,r10,0x70
MD n=Mem ra=0x0000000c d=0x7D5333A6	#	mtspr 211,r10
MD n=Mem ra=0x00000010 d=0x7D7332A6	#	mfspr r11,211	
# </GEN>

CORE n=:P

RD n=NIA     d=0x00000000
RD n=GPR i=9 d=0x1080c000

TRACE

I ea=0x0 id=1
T n=TlbCam t=instr ea=0x0 ra=0x0  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x7d3333a6
INSTR op=0x7d3333a6					asm="mtspr BAR,r9"
R n=BAR d=0x1080c000
ITIME t=2
CTIME t=5

I ea=0x4 id=2
T n=TlbCam t=instr ea=0x4 ra=0x4  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x7d5332a6
INSTR op=0x7d5332a6					asm="mfspr r10,BAR"
R n=GPR i=10 d=0x1080c000
ITIME t=5
CTIME t=8

I ea=0x8 id=3
A l=1 m="Translated using tlb 0 at -1,-1"
T n=TlbCam t=instr ea=0x8 ra=0x8  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x394a0070
INSTR op=0x394a0070					asm="addi r10,r10,112"
R n=GPR i=10 d=0x1080c070
ITIME t=8
CTIME t=11

I ea=0xc id=4
T n=TlbCam t=instr ea=0xc ra=0xc  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0xc ra=0xc d=0x7d5333a6
INSTR op=0x7d5333a6					asm="mtspr BAR,r10"
R n=BAR d=0x1080c071
ITIME t=11
CTIME t=14

I ea=0x10 id=5
A l=1 m="Translated using tlb 0 at -1,-1"
T n=TlbCam t=instr ea=0x10 ra=0x10  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x10 ra=0x10 d=0x7d7332a6
INSTR op=0x7d7332a6					asm="mfspr r11,BAR"
R n=GPR i=11 d=0x1080c071
ITIME t=14
CTIME t=17

I ea=0x14 id=6
T n=TlbCam t=instr ea=0x14 ra=0x14  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x14 ra=0x14 d=0x00000000
INSTR op=0x00000000					asm="halt "
ITIME t=15
CTIME t=18

RESULTS

RD n=BAR d=0x1080c071

RD n=GPR i=9 d=0x1080c000
RD n=GPR i=10 d=0x1080c070
RD n=GPR i=11 d=0x1080c071
