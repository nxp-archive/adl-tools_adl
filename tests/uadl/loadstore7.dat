#
# Test to make sure that we can have conditonal memory accesses in an
# instruction w/o any problems.
#

= asm
  
	stwcx. r1,r0,r10
	addi r10,r10,4
	lis r2,0x8000
	mtspr 72,r2
  stwcx. r1,r0,r10

= /asm

CORE n=:P

# <GEN>
MD n=Mem ra=0x00000000 d=0x7C20512D	#	stwcx. r1,r0,r10
MD n=Mem ra=0x00000004 d=0x394A0004	#	addi r10,r10,4
MD n=Mem ra=0x00000008 d=0x3C408000	#	lis r2,0x8000
MD n=Mem ra=0x0000000c d=0x7C4813A6	#	mtspr 72,r2
MD n=Mem ra=0x00000010 d=0x7C20512D	#	stwcx. r1,r0,r10
# </GEN>

RD n=GPR i=1  d=0xdeadbeef
RD n=GPR i=10 d=0x1000

MD n=Mem ra=0x1000 d=0x0000000
MD n=Mem ra=0x1004 d=0x0000000

TRACE

I ea=0x0 id=1
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x7c20512d
INSTR op=0x7c20512d                                     asm="stwcx. r1,r0,r10"
D n=Mem t=write ea=0x1000 nb=4
M n=Mem t=write ea=0x1000 ra=0x1000 d=0xdeadbeef

I ea=0x4 id=2
INSTR op=0x394a0004                                     asm="addi r10,r10,4"
R n=GPR i=10 d=0x00001004

I ea=0x8 id=3
INSTR op=0x3c408000                                     asm="lis r2,-32768"
R n=GPR i=2 d=0x80000000

I ea=0xc id=4
INSTR op=0x7c4813a6                                     asm="mtspr SCTRL,r2"
R n=SCTRL d=0x80000000

I ea=0x10 id=5
INSTR op=0x7c20512d                                     asm="stwcx. r1,r0,r10"

I ea=0x14 id=6
INSTR op=0x00000000                                     asm="halt "

RESULTS

RD n=GPR i=1 d=0xdeadbeef
RD n=GPR i=10 d=0x00001004

MD n=Mem ra=0x0000000000001000 d=0xdeadbeef     #       (3735928559)
MD n=Mem ra=0x0000000000001004 d=0x00000000     #       (0)
