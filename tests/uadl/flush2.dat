#
# Tests that we can flush the pipeline on a non-branch in a multi-issue
# processor.  This makes sure that the next fetch address is correct via the use
# of set_speculative in the model to halt execution of subsequent instructions
# until the fetch occurs.
#
# This also makes sure that we correctly detect a halt instruction in a
# multi-issue pipeline and don't confuse it with other instructions in the same
# class.
#
= asm

	addi r1,r1,1
	addi r1,r1,1
	isync
	addi r2,r2,2
	addi r2,r2,2
	
= /asm

CORE n=:P

# <GEN>
MD n=Mem ra=0x00000000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000004 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000008 d=0x4C00012C	#	isync
MD n=Mem ra=0x0000000c d=0x38420002	#	addi r2,r2,2
MD n=Mem ra=0x00000010 d=0x38420002	#	addi r2,r2,2
# </GEN>

RD n=NIA      d=0x0

TRACE

I ea=0x0 id=1
T n=TlbCam t=instr ea=0x0 ra=0x0  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=1
R n=GPR i=1 d=0x00000001
CTIME t=5

I ea=0x4 id=2
T n=TlbCam t=instr ea=0x4 ra=0x4  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=1
R n=GPR i=1 d=0x00000002
CTIME t=8

I ea=0x8 id=3
T n=TlbCam t=instr ea=0x8 ra=0x8  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x4c00012c
INSTR op=0x4c00012c					asm="isync "
ITIME t=2
CTIME t=11

I ea=0xc id=4
T n=TlbCam t=instr ea=0xc ra=0xc  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0xc ra=0xc d=0x38420002
INSTR op=0x38420002					asm="addi r2,r2,2"
ITIME t=9
R n=GPR i=2 d=0x00000002
CTIME t=13

I ea=0x10 id=5
T n=TlbCam t=instr ea=0x10 ra=0x10  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x10 ra=0x10 d=0x38420002
INSTR op=0x38420002					asm="addi r2,r2,2"
ITIME t=10
R n=GPR i=2 d=0x00000004
CTIME t=16

I ea=0x14 id=6
T n=TlbCam t=instr ea=0x14 ra=0x14  E=0x0 EPN=0x0 RPN=0x0 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x0 WIMG=0x0
M n=Mem t=ifetch ea=0x14 ra=0x14 d=0x00000000
INSTR op=0x00000000					asm="halt "
ITIME t=10
CTIME t=16

RESULTS

RD n=GPR i=1 d=0x00000002
RD n=GPR i=2 d=0x00000004
