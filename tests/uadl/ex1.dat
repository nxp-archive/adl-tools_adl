#
# Simple test of an exception (protfault) with a simple exception handler.
#
= asm

	addi r1,r1,1
	addi r1,r1,1
	stw r3,0x1004(r0) # Will generate an exception.
	addi r1,r1,1
	.long 0x0
	addi r2,r2,1
	mfspr r31,SRR0
	addi r31,r31,4
	mtspr SRR0,r31
	rfi
	
= /asm

= mdopts

instr-offset: 0x10000

= /mdopts

CORE n=:P

# <GEN>
MD n=Mem ra=0x00010000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00010004 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00010008 d=0x90601004	#	stw r3,0x1004(r0) # Will generate an exception.
MD n=Mem ra=0x0001000c d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00010010 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010014 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00010018 d=0x7FFA02A6	#	mfspr r31,SRR0
MD n=Mem ra=0x0001001c d=0x3BFF0004	#	addi r31,r31,4
MD n=Mem ra=0x00010020 d=0x7FFA03A6	#	mtspr SRR0,r31
MD n=Mem ra=0x00010024 d=0x4C000064	#	rfi
# </GEN>

RD n=NIA     d=0x0
RD n=IVOR6   d=0x14
RD n=IVOR7   d=0x14

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0xA1000.  No read or write access.
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x284 WIMG=0x2 SX=1 SR=0 SW=0 EPN=0x4

MD n=Mem ra=0xA1000 d=0xdeadbeef
MD n=Mem ra=0xA1004 d=0xdeadbeef

TRACE

I ea=0x0 id=1
T n=TlbCam t=instr set=0 way=0 ea=0x0 ra=0x10000  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x0 ra=0x10000 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=1
R n=GPR i=1 d=0x00000001
CTIME t=5

I ea=0x4 id=2
T n=TlbCam t=instr set=0 way=0 ea=0x4 ra=0x10004  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x4 ra=0x10004 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=1
R n=GPR i=1 d=0x00000002
CTIME t=8

I ea=0x8 id=3
T n=TlbCam t=instr set=0 way=0 ea=0x8 ra=0x10008  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x8 ra=0x10008 d=0x90601004
INSTR op=0x90601004					asm="stw r3,4100(r0)"
ITIME t=2
D n=Mem t=write ea=0x1004 nb=4
T n=TlbCam t=store set=0 way=1 ea=0x1004 ra=0xa1004  E=0x0 EPN=0x4 RPN=0x284 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
E n=ProtectionFault
R n=SRR0 d=0x00000008
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000
B taken=1 ea=0x14
CTIME t=8

I ea=0x14 id=4
T n=TlbCam t=instr set=0 way=0 ea=0x14 ra=0x10014  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x14 ra=0x10014 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
ITIME t=7
R n=GPR i=2 d=0x00000001
CTIME t=11

I ea=0x18 id=5
T n=TlbCam t=instr set=0 way=0 ea=0x18 ra=0x10018  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x18 ra=0x10018 d=0x7ffa02a6
INSTR op=0x7ffa02a6					asm="mfspr r31,SRR0"
ITIME t=8
R n=GPR i=31 d=0x00000008
CTIME t=12

I ea=0x1c id=6
T n=TlbCam t=instr set=0 way=0 ea=0x1c ra=0x1001c  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x1c ra=0x1001c d=0x3bff0004
INSTR op=0x3bff0004					asm="addi r31,r31,4"
ITIME t=8
R n=GPR i=31 d=0x0000000c
CTIME t=15

I ea=0x20 id=7
T n=TlbCam t=instr set=0 way=0 ea=0x20 ra=0x10020  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x20 ra=0x10020 d=0x7ffa03a6
INSTR op=0x7ffa03a6					asm="mtspr SRR0,r31"
ITIME t=9
R n=SRR0 d=0x0000000c
CTIME t=18

I ea=0x24 id=8
T n=TlbCam t=instr set=0 way=0 ea=0x24 ra=0x10024  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x24 ra=0x10024 d=0x4c000064
INSTR op=0x4c000064					asm="rfi r0,r0,r0"
ITIME t=12
R n=MSR d=0x00000000
B taken=1 ea=0xc
CTIME t=21

I ea=0xc id=9
T n=TlbCam t=instr set=0 way=0 ea=0xc ra=0x1000c  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xc ra=0x1000c d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=20
R n=GPR i=1 d=0x00000003
CTIME t=24

I ea=0x10 id=10
T n=TlbCam t=instr set=0 way=0 ea=0x10 ra=0x10010  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0x10 ra=0x10010 d=0x00000000
INSTR op=0x00000000					asm="halt "
ITIME t=21
CTIME t=25

RESULTS

RD n=GPR i=1 d=3
RD n=GPR i=2 d=1

MD n=Mem ra=0xA1000 d=0xdeadbeef
MD n=Mem ra=0xA1004 d=0xdeadbeef
