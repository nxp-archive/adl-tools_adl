#
# Simple test to see if we can enable/disable the branch predictor.
# We take series of branches, then turn off the predictor, then
# take some more branches.  We then look at the upipe output to see
# whether or not the predictor is still active.
#
= asm

  addi r2,r2,1
  addi r2,r2,1
  b    t1
  addi r2,r2,1
  addi r2,r2,1
t1:
  addi r3,r3,1
  addi r3,r3,1
  b    t2
  addi r3,r3,1
  addi r3,r3,1
t2:
  # Disable the predictor.
  mtspr 210,r0
  addi r4,r4,1
  addi r4,r4,1
  addi r4,r4,1
  addi r4,r4,1
  addi r4,r4,1
  addi r4,r4,1
  addi r4,r4,1
  addi r4,r4,1
  b    t3
  addi r5,r5,1
t3:
  b    t4
  addi r5,r5,1
t4:
  b    t5
  addi r5,r5,1
t5:
  .long 0x0    

= /asm

CORE n=:P

RD n=NIA     d=0

# Uncomment to keep the predictor always enabled (should cause
# regression to fail).
#RD n=GPR i=0 d=0x80000000


# <GEN>
MD n=Mem ra=0x00000000 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000004 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000008 d=0x4800000C	#	b    t1
MD n=Mem ra=0x0000000c d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000010 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00000014 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000018 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x0000001c d=0x4800000C	#	b    t2
MD n=Mem ra=0x00000020 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000024 d=0x38630001	#	addi r3,r3,1
MD n=Mem ra=0x00000028 d=0x7C1233A6	#	mtspr 210,r0
MD n=Mem ra=0x0000002c d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x00000030 d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x00000034 d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x00000038 d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x0000003c d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x00000040 d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x00000044 d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x00000048 d=0x38840001	#	addi r4,r4,1
MD n=Mem ra=0x0000004c d=0x48000008	#	b    t3
MD n=Mem ra=0x00000050 d=0x38A50001	#	addi r5,r5,1
MD n=Mem ra=0x00000054 d=0x48000008	#	b    t4
MD n=Mem ra=0x00000058 d=0x38A50001	#	addi r5,r5,1
MD n=Mem ra=0x0000005c d=0x48000008	#	b    t5
MD n=Mem ra=0x00000060 d=0x38A50001	#	addi r5,r5,1
MD n=Mem ra=0x00000064 d=0x00000000	#	.long 0x0    
# </GEN>

RESULTS

RD n=GPR i=2 d=2
RD n=GPR i=3 d=2
RD n=GPR i=4 d=8
RD n=GPR i=5 d=0
