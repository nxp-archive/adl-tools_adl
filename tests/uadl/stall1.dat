#
# Tests to make sure that a model with stall_backwards set on
# some stages will stall a pipeline.
#

= asm
  
  lwz r1,0x1002(r0)
  add r4,r3,r2
  lwz r5,0x1002(r0)
  add r8,r7,r6

= /asm

CORE n=:P

RD n=NIA     d=0

RD n=GPR i=2 d=1
RD n=GPR i=3 d=2
RD n=GPR i=6 d=3
RD n=GPR i=7 d=4

MD n=Mem ra=0x1000 d=0xdeadbeef

# <GEN>
MD n=Mem ra=0x00000000 d=0x80201002	#	lwz r1,0x1002(r0)
MD n=Mem ra=0x00000004 d=0x7C831214	#	add r4,r3,r2
MD n=Mem ra=0x00000008 d=0x80A01002	#	lwz r5,0x1002(r0)
MD n=Mem ra=0x0000000c d=0x7D073214	#	add r8,r7,r6
# </GEN>

TRACE

I ea=0x0 id=1
INSTR op=0x80201002                                     asm="lwz r1,4098(r0)"
ITIME t=3
CTIME t=7

I ea=0x4 id=2
INSTR op=0x7c831214                                     asm="add r4,r3,r2"
ITIME t=6
CTIME t=9

I ea=0x8 id=3
INSTR op=0x80a01002                                     asm="lwz r5,4098(r0)"
ITIME t=9
CTIME t=13

I ea=0xc id=4
INSTR op=0x7d073214                                     asm="add r8,r7,r6"
ITIME t=12
CTIME t=15

I ea=0x10 id=5
INSTR op=0x00000000                                     asm="halt "
ITIME t=15
CTIME t=18

RESULTS

RD n=GPR i=1 d=0xbeef0000
RD n=GPR i=4 d=3
RD n=GPR i=5 d=0xbeef0000
RD n=GPR i=8 d=7
