#
# Make sure that a lazy-writeback linefill buffer will flush itself to the cache
# at the end of simulation, so that the final state is accurately reflected.
#
CORE n=:P

= asm

	addi r1,r1,1
	addi r1,r1,1
	lwz r2,0x1000(r0)

= /asm

# <GEN>
MD n=Mem ra=0x00000000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000004 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000008 d=0x80401000	#	lwz r2,0x1000(r0)
# </GEN>

MD n=Mem ra=0x1000 d=0xdeadbeef

TRACE

I ea=0x0 id=1
C n=L1 a=miss t=ifetch set=0 way=0 lm=0x7f ra=0x0
M n=Mem t=ifetch ea=0x0 ra=0x0 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=3
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
R n=GPR i=1 d=0x00000001
CTIME t=7

I ea=0x4 id=2
M n=Mem t=ifetch ea=0x4 ra=0x4 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=4
R n=GPR i=1 d=0x00000002
CTIME t=10

I ea=0x8 id=3
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
M n=Mem t=ifetch ea=0x8 ra=0x8 d=0x80401000
INSTR op=0x80401000					asm="lwz r2,4096(r0)"
ITIME t=7
D n=Mem t=read ea=0x1000 nb=4
C n=L1 a=miss t=read set=32 way=0 lm=0x7f ra=0x1000
M n=Mem t=read ea=0x1000 ra=0x1000 d=0xdeadbeef
R n=GPR i=2 d=0xdeadbeef
CTIME t=20

I ea=0xc id=4
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
C n=L1 a=hit t=ifetch set=0 way=0 lm=0x7f ra=0x0
M n=Mem t=ifetch ea=0xc ra=0xc d=0x00000000
INSTR op=0x00000000					asm="halt "
ITIME t=10
CTIME t=25

RESULTS

RD n=GPR i=1 d=0x00000002
RD n=GPR i=2 d=0xdeadbeef

CD n=L1 set=0 way=0 ra=0x0000000000000000 valid=1 dirty=0 locked=0 d=0x38210001,0x38210001,0x80401000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
CD n=L1 set=32 way=0 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

MD n=Mem ra=0x0000000000001000 d=0xdeadbeef	#	(3735928559)
