#
# Checks fetch-exceptions with misaligned fetches.  Actually, they're aligned,
# but since this happens immediately, it uses the same code path as misaligned.
#
= asm

	addi r1,r1,1   # Won't happen.
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
	.long 0x0
	addi r2,r2,2   # Will be skiped.
	addi r3,r3,3
	addi r3,r3,3
	
= /asm

= mdopts 

instr-offset: 0x10fe4

= /mdopts

CORE n=:P

# <GEN>
MD n=Mem ra=0x00010fe4 d=0x38210001	#	addi r1,r1,1   # Won't happen.
MD n=Mem ra=0x00010fe8 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010fec d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010ff0 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010ff4 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010ff8 d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010ffc d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00011000 d=0x38420002	#	addi r2,r2,2   # Will be skiped.
MD n=Mem ra=0x00011004 d=0x38630003	#	addi r3,r3,3
MD n=Mem ra=0x00011008 d=0x38630003	#	addi r3,r3,3
# </GEN>

RD n=NIA      d=0x0fe4
RD n=IVOR7    d=0x1004

# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 SX=0 SR=0 SW=0 EPN=0

# ea=0x1000 ra=0x11000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x44 WIMG=0x2 SX=1 SR=0 SW=0 EPN=0x4

TRACE

I ea=0xfe4 id=1
T n=TlbCam t=instr set=0 way=0 ea=0xfe4 ra=0x10fe4  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
E n=ProtectionFault
R n=SRR0 d=0x00000fe4
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000
R n=ESR d=0x00000000
B taken=1 ea=0x1004

I ea=0x1004 id=2
T n=TlbCam t=instr set=0 way=1 ea=0x1004 ra=0x11004  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem t=ifetch ea=0x1004 ra=0x11004 d=0x38630003
INSTR op=0x38630003					asm="addi r3,r3,3"
R n=GPR i=3 d=0x00000003

I ea=0x1008 id=3
T n=TlbCam t=instr set=0 way=1 ea=0x1008 ra=0x11008  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem t=ifetch ea=0x1008 ra=0x11008 d=0x38630003
INSTR op=0x38630003					asm="addi r3,r3,3"
R n=GPR i=3 d=0x00000006

I ea=0x100c id=4
T n=TlbCam t=instr set=0 way=1 ea=0x100c ra=0x1100c  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x0 SW=0x0 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
M n=Mem t=ifetch ea=0x100c ra=0x1100c d=0x00000000
INSTR op=0x00000000					asm="halt "

RESULTS

RD n=GPR i=1 d=0
RD n=GPR i=2 d=0
RD n=GPR i=3 d=6

RD n=SRR0 d=0x00000fe4
RD n=SRR1 d=0x00000000
