#
# Test to see if we can simulate a false WAW hazard
# via virtual flags and a register inquire.
#
= asm
  
  addi r1,r1,1
  lwz  r2,0x1000(r0)
  lwz  r2,0x1000(r0)
  lwz  r3,0x1004(r0)

= /asm

CORE n=:P

# <GEN>
MD n=Mem ra=0x00000000 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00000004 d=0x80401000	#	lwz  r2,0x1000(r0)
MD n=Mem ra=0x00000008 d=0x80401000	#	lwz  r2,0x1000(r0)
MD n=Mem ra=0x0000000c d=0x80601004	#	lwz  r3,0x1004(r0)
# </GEN>

MD n=Mem ra=0x1000 d=0xdeadbeef
MD n=Mem ra=0x1004 d=0x12345678

RD n=NIA d=0

TRACE

I ea=0x0 id=1
INSTR op=0x38210001					asm="addi r1,r1,1"
ITIME t=1
CTIME t=5

I ea=0x4 id=2
INSTR op=0x80401000					asm="lwz r2,4096(r0)"
ITIME t=2
CTIME t=6

# Here's the stall; Back-to-back WAW causes a stall in our contrived example.
I ea=0x8 id=3
INSTR op=0x80401000					asm="lwz r2,4096(r0)"
ITIME t=3
CTIME t=8

I ea=0xc id=4
INSTR op=0x80601004					asm="lwz r3,4100(r0)"
ITIME t=4
CTIME t=9

I ea=0x10 id=5
INSTR op=0x00000000					asm="halt "
ITIME t=6
CTIME t=10

RESULTS

RD n=GPR i=1  d=1
RD n=GPR i=2  d=0xdeadbeef
RD n=GPR i=3  d=0x12345678

MD n=Mem ra=0x1000 d=0xdeadbeef
MD n=Mem ra=0x1004 d=0x12345678

