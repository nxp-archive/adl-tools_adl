#
# Tests to make sure that an exception on a fetch will work
# properly with a multi-issue model.
#

= asm

  addi r2,r2,1  # Destination of protection exception.
  addi r2,r2,2
  .long 0x0
  addi r1,r1,1
  addi r1,r1,2
  addi r1,r1,3
  addi r1,r1,4
  addi r1,r1,5  # Will not be issued/fetch due to protection fault.
  addi r1,r1,6  # Same as above.
  
= /asm

= mdopts

instr-offset: 0x10fe4

= /mdopts


# ea=0x0000 ra=0x10000
TD n=TlbCam set=0 way=0 V=1 TID=0 SIZE=1 TS=0 RPN=0x40 WIMG=0x1 SX=1 SR=1 SW=1 EPN=0

# ea=0x1000 ra=0x11000
TD n=TlbCam set=0 way=1 V=1 TID=0 SIZE=1 TS=0 RPN=0x44 WIMG=0x2 SX=0 SR=0 SW=0 EPN=0x4


CORE n=:P

# <GEN>
MD n=Mem ra=0x00010fe4 d=0x38420001	#	addi r2,r2,1
MD n=Mem ra=0x00010fe8 d=0x38420002	#	addi r2,r2,2
MD n=Mem ra=0x00010fec d=0x00000000	#	.long 0x0
MD n=Mem ra=0x00010ff0 d=0x38210001	#	addi r1,r1,1
MD n=Mem ra=0x00010ff4 d=0x38210002	#	addi r1,r1,2
MD n=Mem ra=0x00010ff8 d=0x38210003	#	addi r1,r1,3
MD n=Mem ra=0x00010ffc d=0x38210004	#	addi r1,r1,4
MD n=Mem ra=0x00011000 d=0x38210005	#	addi r1,r1,5
MD n=Mem ra=0x00011004 d=0x38210006	#	addi r1,r1,6
# </GEN>

RD n=NIA d=0xff0

RD n=IVOR7 d=0xfe4

TRACE

I ea=0xff0 id=1
T n=TlbCam t=instr set=0 way=0 ea=0xff0 ra=0x10ff0  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xff0 ra=0x10ff0 d=0x38210001
INSTR op=0x38210001					asm="addi r1,r1,1"
R n=GPR i=1 d=0x00000001

I ea=0xff4 id=2
T n=TlbCam t=instr set=0 way=0 ea=0xff4 ra=0x10ff4  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xff4 ra=0x10ff4 d=0x38210002
INSTR op=0x38210002					asm="addi r1,r1,2"
R n=GPR i=1 d=0x00000003

I ea=0xff8 id=3
T n=TlbCam t=instr set=0 way=0 ea=0xff8 ra=0x10ff8  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xff8 ra=0x10ff8 d=0x38210003
INSTR op=0x38210003					asm="addi r1,r1,3"
R n=GPR i=1 d=0x00000006

I ea=0xffc id=4
T n=TlbCam t=instr set=0 way=0 ea=0xffc ra=0x10ffc  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xffc ra=0x10ffc d=0x38210004
INSTR op=0x38210004					asm="addi r1,r1,4"
R n=GPR i=1 d=0x0000000a

I ea=0x1000 id=5
T n=TlbCam t=instr set=0 way=1 ea=0x1000 ra=0x11000  E=0x0 EPN=0x4 RPN=0x44 SIZE=0x1 SR=0x0 SW=0x0 SX=0x0 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x2
E n=ProtectionFault
R n=SRR0 d=0x00001000
R n=SRR1 d=0x00000000
R n=MSR d=0x00000000
R n=ESR d=0x00000000
B taken=1 ea=0xfe4

I ea=0xfe4 id=6
T n=TlbCam t=instr set=0 way=0 ea=0xfe4 ra=0x10fe4  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xfe4 ra=0x10fe4 d=0x38420001
INSTR op=0x38420001					asm="addi r2,r2,1"
R n=GPR i=2 d=0x00000001

I ea=0xfe8 id=7
T n=TlbCam t=instr set=0 way=0 ea=0xfe8 ra=0x10fe8  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xfe8 ra=0x10fe8 d=0x38420002
INSTR op=0x38420002					asm="addi r2,r2,2"
R n=GPR i=2 d=0x00000003

I ea=0xfec id=8
T n=TlbCam t=instr set=0 way=0 ea=0xfec ra=0x10fec  E=0x0 EPN=0x0 RPN=0x40 SIZE=0x1 SR=0x1 SW=0x1 SX=0x1 TID=0x0 TS=0x0 UR=0x0 UW=0x0 UX=0x0 V=0x1 WIMG=0x1
M n=Mem t=ifetch ea=0xfec ra=0x10fec d=0x00000000
INSTR op=0x00000000					asm="halt "

RESULTS

RD n=GPR i=1 d=10
RD n=GPR i=2 d=3
