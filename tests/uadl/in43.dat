#
# Tests cache modification instructions.
#

CORE n=:P

= asm

	dcbt r0,r10         # Brings in 0x1000 line
	lwz  r2,0x0(r10)
	addi r2,r2,0x3000
	stw  r2,0x4(r10)
	dcbf r0,r10         # Flushes dirty 0x1000 line
	addi r2,r2,0x3000
	stw  r2,0x8(r10)
	dcbi r0,r10         # Invalidates dirty 0x1000 line
	stw  r2,0xc(r10)
	dcbst r0,r10        # Stores 0x1000 line (still valid)
	dcba  r0,r11        # Allocates 0x3000 line
	stw  r2,0x0(r11)
	dcbf r0,r11         # Flushes 0x3000 line
	dcbz r0,r12         # Zero out 0x2000 line
	dcbf r0,r12         # Push to memory

= /asm

= aopts

 -mregnames -mbooke

= /aopts

= mdopts

 instr-offset: 0x100

= /mdopts

# <GEN>
MD n=Mem ra=0x00000100 d=0x7C00522C	#	dcbt r0,r10         # Brings in 0x1000 line
MD n=Mem ra=0x00000104 d=0x804A0000	#	lwz  r2,0x0(r10)
MD n=Mem ra=0x00000108 d=0x38423000	#	addi r2,r2,0x3000
MD n=Mem ra=0x0000010c d=0x904A0004	#	stw  r2,0x4(r10)
MD n=Mem ra=0x00000110 d=0x7C0050AC	#	dcbf r0,r10         # Flushes dirty 0x1000 line
MD n=Mem ra=0x00000114 d=0x38423000	#	addi r2,r2,0x3000
MD n=Mem ra=0x00000118 d=0x904A0008	#	stw  r2,0x8(r10)
MD n=Mem ra=0x0000011c d=0x7C0053AC	#	dcbi r0,r10         # Invalidates dirty 0x1000 line
MD n=Mem ra=0x00000120 d=0x904A000C	#	stw  r2,0xc(r10)
MD n=Mem ra=0x00000124 d=0x7C00506C	#	dcbst r0,r10        # Stores 0x1000 line (still valid)
MD n=Mem ra=0x00000128 d=0x7C005DEC	#	dcba  r0,r11        # Allocates 0x3000 line
MD n=Mem ra=0x0000012c d=0x904B0000	#	stw  r2,0x0(r11)
MD n=Mem ra=0x00000130 d=0x7C0058AC	#	dcbf r0,r11         # Flushes 0x3000 line
MD n=Mem ra=0x00000134 d=0x7C0067EC	#	dcbz r0,r12         # Zero out 0x2000 line
MD n=Mem ra=0x00000138 d=0x7C0060AC	#	dcbf r0,r12         # Push to memory
# </GEN>

RD n=NIA d=0x0100
RD n=GPR i=10 d=0x1000
RD n=GPR i=11 d=0x3000
RD n=GPR i=12 d=0x2000
RD n=CCR d=0xc0000000

MD n=Mem ra=0x1000 d=0xdeadbeef
MD n=Mem ra=0x1004 d=0x00000000
MD n=Mem ra=0x1008 d=0x00000000
MD n=Mem ra=0x100c d=0x00000000

MD n=Mem ra=0x2000 d=0xffffffff
MD n=Mem ra=0x2004 d=0xffffffff
MD n=Mem ra=0x2008 d=0xffffffff

MD n=Mem ra=0x3000 d=0x00000000

RESULTS

CD n=L1d set=32 way=2 ra=0x0000000000001000 valid=1 dirty=0 locked=0 d=0xdeadbeef,0xdeadeeef,0x00000000,0xdeae1eef,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000

MD n=Mem ra=0x0000000000001000 d=0xdeadbeef
MD n=Mem ra=0x0000000000001004 d=0xdeadeeef
MD n=Mem ra=0x000000000000100c d=0xdeae1eef
MD n=Mem ra=0x0000000000002000 d=0x00000000
MD n=Mem ra=0x0000000000002004 d=0x00000000
MD n=Mem ra=0x0000000000002008 d=0x00000000
MD n=Mem ra=0x0000000000003000 d=0xdeae1eef

